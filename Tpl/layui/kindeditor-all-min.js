(function(window,undefined){if(window.KindEditor){return}if(!window.console){window.console={}}if(!console.log){console.log=function(){}}var _VERSION="4.1.12 (2019-03-07)",_ua=navigator.userAgent.toLowerCase(),_IE=_ua.indexOf("msie")>-1&&_ua.indexOf("opera")==-1,_NEWIE=_ua.indexOf("msie")==-1&&_ua.indexOf("trident")>-1,_GECKO=_ua.indexOf("gecko")>-1&&_ua.indexOf("khtml")==-1,_WEBKIT=_ua.indexOf("applewebkit")>-1,_OPERA=_ua.indexOf("opera")>-1,_MOBILE=_ua.indexOf("mobile")>-1,_IOS=/ipad|iphone|ipod/.test(_ua),_QUIRKS=document.compatMode!="CSS1Compat",_IERANGE=!window.getSelection,_matches=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(_ua),_V=_matches?_matches[1]:"0",_TIME=(new Date).getTime();function _isArray(e){if(!e){return false}return Object.prototype.toString.call(e)==="[object Array]"}function _isFunction(e){if(!e){return false}return Object.prototype.toString.call(e)==="[object Function]"}function _inArray(e,t){for(var n=0,i=t.length;n<i;n++){if(e===t[n]){return n}}return-1}function _each(e,t){if(_isArray(e)){for(var n=0,i=e.length;n<i;n++){if(t.call(e[n],n,e[n])===false){break}}}else{for(var a in e){if(e.hasOwnProperty(a)){if(t.call(e[a],a,e[a])===false){break}}}}}function _trim(e){return e.replace(/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")}function _inString(e,t,n){n=n===undefined?",":n;return(n+t+n).indexOf(n+e+n)>=0}function _addUnit(e,t){t=t||"px";return e&&/^-?\d+(?:\.\d+)?$/.test(e)?e+t:e}function _removeUnit(e){var t;return e&&(t=/(\d+)/.exec(e))?parseInt(t[1],10):0}function _escape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function _unescape(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}function _toCamel(n){var e=n.split("-");n="";_each(e,function(e,t){n+=e>0?t.charAt(0).toUpperCase()+t.substr(1):t});return n}function _toHex(e){function a(e){var t=parseInt(e,10).toString(16).toUpperCase();return t.length>1?t:"0"+t}return e.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/gi,function(e,t,n,i){return"#"+a(t)+a(n)+a(i)})}function _toMap(e,t){t=t===undefined?",":t;var i={},n=_isArray(e)?e:e.split(t),a;_each(n,function(e,t){if(a=/^(\d+)\.\.(\d+)$/.exec(t)){for(var n=parseInt(a[1],10);n<=parseInt(a[2],10);n++){i[n.toString()]=true}}else{i[t]=true}});return i}function _toArray(e,t){return Array.prototype.slice.call(e,t||0)}function _undef(e,t){return e===undefined?t:e}function _invalidUrl(e){return!e||/[<>"]/.test(e)}function _addParam(e,t){return e.indexOf("?")>=0?e+"&"+t:e+"?"+t}function _extend(e,t,n){if(!n){n=t;t=null}var i;if(t){var a=function(){};a.prototype=t.prototype;i=new a;_each(n,function(e,t){i[e]=t})}else{i=n}i.constructor=e;e.prototype=i;e.parent=t?t.prototype:null}function _json(text){var match;if(match=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(text)){text=match[0]}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")}throw"JSON parse error"}var _round=Math.round;var K={DEBUG:false,VERSION:_VERSION,IE:_IE,GECKO:_GECKO,WEBKIT:_WEBKIT,OPERA:_OPERA,V:_V,TIME:_TIME,each:_each,isArray:_isArray,isFunction:_isFunction,inArray:_inArray,inString:_inString,trim:_trim,addUnit:_addUnit,removeUnit:_removeUnit,escape:_escape,unescape:_unescape,toCamel:_toCamel,toHex:_toHex,toMap:_toMap,toArray:_toArray,undef:_undef,invalidUrl:_invalidUrl,addParam:_addParam,extend:_extend,json:_json};var _INLINE_TAG_MAP=_toMap("a,abbr,acronym,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,img,input,ins,kbd,label,map,q,s,samp,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),_BLOCK_TAG_MAP=_toMap("address,applet,blockquote,body,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,iframe,ins,isindex,li,map,menu,meta,noframes,noscript,object,ol,p,pre,script,style,table,tbody,td,tfoot,th,thead,title,tr,ul"),_SINGLE_TAG_MAP=_toMap("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),_STYLE_TAG_MAP=_toMap("b,basefont,big,del,em,font,i,s,small,span,strike,strong,sub,sup,u"),_CONTROL_TAG_MAP=_toMap("img,table,input,textarea,button"),_PRE_TAG_MAP=_toMap("pre,style,script"),_NOSPLIT_TAG_MAP=_toMap("html,head,body,td,tr,table,ol,ul,li"),_AUTOCLOSE_TAG_MAP=_toMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),_FILL_ATTR_MAP=_toMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),_VALUE_TAG_MAP=_toMap("input,button,textarea,select");function _getBasePath(){var e=document.getElementsByTagName("script"),t;for(var n=0,i=e.length;n<i;n++){t=e[n].src||"";if(/kindeditor[\w\-\.]*\.js/.test(t)){return t.substring(0,t.lastIndexOf("/")+1)}}return window.kindURL||""}K.basePath=_getBasePath();K.options={designMode:true,fullscreenMode:false,filterMode:true,wellFormatMode:true,shadowMode:true,loadStyleMode:true,basePath:K.basePath,themesPath:K.basePath+"themes/",langPath:K.basePath+"lang/",pluginsPath:K.basePath+"plugins/",themeType:"default",langType:"zh-CN",urlType:"",newlineTag:"p",resizeType:2,syncType:"form",pasteType:2,dialogAlignType:"page",useContextmenu:true,fullscreenShortcut:false,bodyClass:"ke-content",indentChar:"\t",cssPath:"",cssData:"",minWidth:650,minHeight:100,minChangeSize:50,zIndex:811213,items:["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],noDisableItems:["source","fullscreen"],colorTable:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],fontSizeTable:["9px","10px","12px","14px","16px","18px","24px","32px"],htmlTags:{font:["id","class","color","size","face",".background-color"],span:["id","class",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".line-height"],div:["id","class","align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["id","class","border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height",".border-collapse"],"td,th":["id","class","align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background",".border"],a:["id","class","href","target","name"],embed:["id","class","src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess","wmode"],img:["id","class","src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["id","class","align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["id","class"],hr:["id","class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":["id","class"],iframe:["id","class","src","frameborder","width","height",".width",".height"]},layout:'<div class="container"><div class="toolbar"></div><div class="edit"></div><div class="statusbar"></div></div>'};var _useCapture=false;var _INPUT_KEY_MAP=_toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222");var _CURSORMOVE_KEY_MAP=_toMap("33..40");var _CHANGE_KEY_MAP={};_each(_INPUT_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t});_each(_CURSORMOVE_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t});function _bindEvent(e,t,n){if(e.addEventListener){e.addEventListener(t,n,_useCapture)}else if(e.attachEvent){e.attachEvent("on"+t,n)}}function _unbindEvent(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,_useCapture)}else if(e.detachEvent){e.detachEvent("on"+t,n)}}var _EVENT_PROPS="altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,data,detail,eventPhase,fromElement,handler,keyCode,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which".split(",");function KEvent(e,t){this.init(e,t)}_extend(KEvent,{init:function(e,n){var i=this,t=e.ownerDocument||e.document||e;i.event=n;_each(_EVENT_PROPS,function(e,t){i[t]=n[t]});if(!i.target){i.target=i.srcElement||t}if(i.target.nodeType===3){i.target=i.target.parentNode}if(!i.relatedTarget&&i.fromElement){i.relatedTarget=i.fromElement===i.target?i.toElement:i.fromElement}if(i.pageX==null&&i.clientX!=null){var a=t.documentElement,r=t.body;i.pageX=i.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0);i.pageY=i.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)}if(!i.which&&(i.charCode||i.charCode===0?i.charCode:i.keyCode)){i.which=i.charCode||i.keyCode}if(!i.metaKey&&i.ctrlKey){i.metaKey=i.ctrlKey}if(!i.which&&i.button!==undefined){i.which=i.button&1?1:i.button&2?3:i.button&4?2:0}switch(i.which){case 186:i.which=59;break;case 187:case 107:case 43:i.which=61;break;case 189:case 45:i.which=109;break;case 42:i.which=106;break;case 47:i.which=111;break;case 78:i.which=110;break}if(i.which>=96&&i.which<=105){i.which-=48}},preventDefault:function(){var e=this.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){var e=this.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},stop:function(){this.preventDefault();this.stopPropagation()}});var _eventExpendo="kindeditor_"+_TIME,_eventId=0,_eventData={};function _getId(e){return e[_eventExpendo]||null}function _setId(e){e[_eventExpendo]=++_eventId;return _eventId}function _removeId(t){try{delete t[_eventExpendo]}catch(e){if(t.removeAttribute){t.removeAttribute(_eventExpendo)}}}function _bind(i,e,t){if(e.indexOf(",")>=0){_each(e.split(","),function(){_bind(i,this,t)});return}var n=_getId(i);if(!n){n=_setId(i)}if(_eventData[n]===undefined){_eventData[n]={}}var a=_eventData[n][e];if(a&&a.length>0){_unbindEvent(i,e,a[0])}else{_eventData[n][e]=[];_eventData[n].el=i}a=_eventData[n][e];if(a.length===0){a[0]=function(e){var n=e?new KEvent(i,e):undefined;_each(a,function(e,t){if(e>0&&t){t.call(i,n)}})}}if(_inArray(t,a)<0){a.push(t)}_bindEvent(i,e,a[0])}function _unbind(n,e,i){if(e&&e.indexOf(",")>=0){_each(e.split(","),function(){_unbind(n,this,i)});return}var t=_getId(n);if(!t){return}if(e===undefined){if(t in _eventData){_each(_eventData[t],function(e,t){if(e!="el"&&t.length>0){_unbindEvent(n,e,t[0])}});delete _eventData[t];_removeId(n)}return}if(!_eventData[t]){return}var a=_eventData[t][e];if(a&&a.length>0){if(i===undefined){_unbindEvent(n,e,a[0]);delete _eventData[t][e]}else{_each(a,function(e,t){if(e>0&&t===i){a.splice(e,1)}});if(a.length==1){_unbindEvent(n,e,a[0]);delete _eventData[t][e]}}var r=0;_each(_eventData[t],function(){r++});if(r<2){delete _eventData[t];_removeId(n)}}}function _fire(e,t){if(t.indexOf(",")>=0){_each(t.split(","),function(){_fire(e,this)});return}var n=_getId(e);if(!n){return}var i=_eventData[n][t];if(_eventData[n]&&i&&i.length>0){i[0]()}}function _ctrl(t,n,i){var e=this;n=/^\d{2,}$/.test(n)?n:n.toUpperCase().charCodeAt(0);_bind(t,"keydown",function(e){if(e.ctrlKey&&e.which==n&&!e.shiftKey&&!e.altKey){i.call(t);e.stop()}})}var _readyFinished=false;function _ready(e){if(_readyFinished){e(KindEditor);return}var t=false;function n(){if(!t){t=true;e(KindEditor);_readyFinished=true}}function i(){if(!t){try{document.documentElement.doScroll("left")}catch(e){setTimeout(i,100);return}n()}}function a(){if(document.readyState==="complete"){n()}}if(document.addEventListener){_bind(document,"DOMContentLoaded",n)}else if(document.attachEvent){_bind(document,"readystatechange",a);var r=false;try{r=window.frameElement==null}catch(e){}if(document.documentElement.doScroll&&r){i()}}_bind(window,"load",n)}if(window.attachEvent){window.attachEvent("onunload",function(){_each(_eventData,function(e,t){if(t.el){_unbind(t.el)}})})}K.ctrl=_ctrl;K.ready=_ready;function _getCssList(e){e=e.replace(/&quot;/g,'"');var t={},n=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g,i;while(i=n.exec(e)){var a=_trim(i[1].toLowerCase()),r=_trim(_toHex(i[2]));t[a]=r}return t}function _getAttrList(e){var t={},n=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g,i;while(i=n.exec(e)){var a=(i[1]||i[2]||i[4]||i[6]).toLowerCase(),r=(i[2]?i[3]:i[4]?i[5]:i[7])||"";t[a]=r}return t}function _addClassToTag(e,a){if(/\s+class\s*=/.test(e)){e=e.replace(/(\s+class=["']?)([^"']*)(["']?[\s>])/,function(e,t,n,i){if((" "+n+" ").indexOf(" "+a+" ")<0){return n===""?t+a+i:t+n+" "+a+i}else{return e}})}else{e=e.substr(0,e.length-1)+' class="'+a+'">'}return e}function _formatCss(e){var n="";_each(_getCssList(e),function(e,t){n+=e+":"+t+";"});return n}function _formatUrl(r,e,t,o){e=_undef(e,"").toLowerCase();if(r.substr(0,5)!="data:"){r=r.replace(/([^:])\/\//g,"$1/")}if(_inArray(e,["absolute","relative","domain"])<0){return r}t=t||location.protocol+"//"+location.host;if(o===undefined){var n=location.pathname.match(/^(\/.*)\//);o=n?n[1]:""}var l;if(l=/^(\w+:\/\/[^\/]*)/.exec(r)){if(l[1]!==t){return r}}else if(/^\w+:/.test(r)){return r}function i(e){var t=e.split("/"),n=[];for(var i=0,a=t.length;i<a;i++){var r=t[i];if(r==".."){if(n.length>0){n.pop()}}else if(r!==""&&r!="."){n.push(r)}}return"/"+n.join("/")}if(/^\//.test(r)){r=t+i(r.substr(1))}else if(!/^\w+:\/\//.test(r)){r=t+i(o+"/"+r)}function s(e,t){if(r.substr(0,e.length)===e){var n=[];for(var i=0;i<t;i++){n.push("..")}var a=".";if(n.length>0){a+="/"+n.join("/")}if(o=="/"){a+="/"}return a+r.substr(e.length)}else{if(l=/^(.*)\//.exec(e)){return s(l[1],++t)}}}if(e==="relative"){r=s(t+o,0).substr(2)}else if(e==="absolute"){if(r.substr(0,t.length)===t){r=r.substr(t.length)}}return r}function _formatHtml(e,b,k,y,w){if(e==null){e=""}k=k||"";y=_undef(y,false);w=_undef(w,"\t");var C="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(e,t,n,i){return t+n.replace(/<(?:br|br\s[^>]*)>/gi,"\n")+i});e=e.replace(/<(?:br|br\s[^>]*)\s*\/?>\s*<\/p>/gi,"</p>");e=e.replace(/(<(?:p|p\s[^>]*)>)\s*(<\/p>)/gi,"$1<br />$2");e=e.replace(/\u200B/g,"");e=e.replace(/\u00A9/g,"&copy;");e=e.replace(/\u00AE/g,"&reg;");e=e.replace(/\u2003/g,"&emsp;");e=e.replace(/\u3000/g,"&emsp;");e=e.replace(/<[^>]+/g,function(e){return e.replace(/\s+/g," ")});var x={};if(b){_each(b,function(e,t){var n=e.split(",");for(var i=0,a=n.length;i<a;i++){x[n[i]]=_toMap(t)}});if(!x.script){e=e.replace(/(<(?:script|script\s[^>]*)>)([\s\S]*?)(<\/script>)/gi,"")}if(!x.style){e=e.replace(/(<(?:style|style\s[^>]*)>)([\s\S]*?)(<\/style>)/gi,"")}}var t=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g;var T=[];e=e.replace(t,function(e,t,n,i,a,r,o){var l=e,s=t||"",d=n||"",c=i.toLowerCase(),u=a||"",f=r?" "+r:"",p=o||"";if(b&&!x[c]){return""}if(f===""&&_SINGLE_TAG_MAP[c]){f=" /"}if(_INLINE_TAG_MAP[c]){if(s){s=" "}if(p){p=" "}}if(_PRE_TAG_MAP[c]){if(d){p="\n"}else{s="\n"}}if(y&&c=="br"){p="\n"}if(_BLOCK_TAG_MAP[c]&&!_PRE_TAG_MAP[c]){if(y){if(d&&T.length>0&&T[T.length-1]===c){T.pop()}else{T.push(c)}s="\n";p="\n";for(var h=0,m=d?T.length:T.length-1;h<m;h++){s+=w;if(!d){p+=w}}if(f){T.pop()}else if(!d){p+=w}}else{s=p=""}}if(u!==""){var g=_getAttrList(l);if(c==="font"){var v={},_="";_each(g,function(e,t){if(e==="color"){v.color=t;delete g[e]}if(e==="size"){v["font-size"]=C[parseInt(t,10)-1]||"";delete g[e]}if(e==="face"){v["font-family"]=t;delete g[e]}if(e==="style"){_=t}});if(_&&!/;$/.test(_)){_+=";"}_each(v,function(e,t){if(t===""){return}if(/\s/.test(t)){t="'"+t+"'"}_+=e+":"+t+";"});g.style=_}_each(g,function(e,t){if(_FILL_ATTR_MAP[e]){g[e]=e}if(_inArray(e,["src","href"])>=0){g[e]=_formatUrl(t,k)}if(b&&e!=="style"&&!x[c]["*"]&&!x[c][e]||c==="body"&&e==="contenteditable"||/^kindeditor_\d+$/.test(e)){delete g[e]}if(e==="style"&&t!==""){var n=_getCssList(t);_each(n,function(e,t){if(b&&!x[c].style&&!x[c]["."+e]){delete n[e]}});var i="";_each(n,function(e,t){i+=e+":"+t+";"});g.style=i}});u="";_each(g,function(e,t){if(e==="style"&&t===""){return}t=t.replace(/"/g,"&quot;");u+=" "+e+'="'+t+'"'})}if(c==="font"){c="span"}return s+"<"+d+c+u+f+">"+p});e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(e,t,n,i){return t+n.replace(/\n/g,'<span id="__kindeditor_pre_newline__">\n')+i});e=e.replace(/\n\s*\n/g,"\n");e=e.replace(/<span id="__kindeditor_pre_newline__">\n/g,"\n");return _trim(e)}function _clearMsWord(e,t){e=e.replace(/<meta[\s\S]*?>/gi,"").replace(/<![\s\S]*?>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<w:[^>]+>[\s\S]*?<\/w:[^>]+>/gi,"").replace(/<o:[^>]+>[\s\S]*?<\/o:[^>]+>/gi,"").replace(/<xml>[\s\S]*?<\/xml>/gi,"").replace(/<(?:table|td)[^>]*>/gi,function(e){return e.replace(/border-bottom:([#\w\s]+)/gi,"border:$1")});return _formatHtml(e,t)}function _mediaType(e){if(/\.(rm|rmvb)(\?|$)/i.test(e)){return"audio/x-pn-realaudio-plugin"}if(/\.(swf|flv)(\?|$)/i.test(e)){return"application/x-shockwave-flash"}return"video/x-ms-asf-plugin"}function _mediaClass(e){if(/realaudio/i.test(e)){return"ke-rm"}if(/flash/i.test(e)){return"ke-flash"}return"ke-media"}function _mediaAttrs(e){return _getAttrList(unescape(e))}function _mediaEmbed(e){var n="<embed ";_each(e,function(e,t){n+=e+'="'+t+'" '});n+="/>";return n}function _mediaImg(e,t){var n=t.width,i=t.height,a=t.type||_mediaType(t.src),r=_mediaEmbed(t),o="";if(/\D/.test(n)){o+="width:"+n+";"}else if(n>0){o+="width:"+n+"px;"}if(/\D/.test(i)){o+="height:"+i+";"}else if(i>0){o+="height:"+i+"px;"}var l='<img class="'+_mediaClass(a)+'" src="'+e+'" ';if(o!==""){l+='style="'+o+'" '}l+='data-ke-tag="'+escape(r)+'" alt="" />';return l}function _tmpl(e,t){var n=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return t?n(t):n}K.formatUrl=_formatUrl;K.formatHtml=_formatHtml;K.getCssList=_getCssList;K.getAttrList=_getAttrList;K.mediaType=_mediaType;K.mediaAttrs=_mediaAttrs;K.mediaEmbed=_mediaEmbed;K.mediaImg=_mediaImg;K.clearMsWord=_clearMsWord;K.tmpl=_tmpl;function _contains(e,t){if(e.nodeType==9&&t.nodeType!=9){return true}while(t=t.parentNode){if(t==e){return true}}return false}var _getSetAttrDiv=document.createElement("div");_getSetAttrDiv.setAttribute("className","t");var _GET_SET_ATTRIBUTE=_getSetAttrDiv.className!=="t";function _getAttr(e,t){t=t.toLowerCase();var n=null;if(!_GET_SET_ATTRIBUTE&&e.nodeName.toLowerCase()!="script"){var i=e.ownerDocument.createElement("div");i.appendChild(e.cloneNode(false));var a=_getAttrList(_unescape(i.innerHTML));if(t in a){n=a[t]}}else{try{n=e.getAttribute(t,2)}catch(i){n=e.getAttribute(t,1)}}if(t==="style"&&n!==null){n=_formatCss(n)}return n}function _queryAll(e,t){var n=e.split(",");if(n.length>1){var i=[];_each(n,function(){_each(_queryAll(this,t),function(){if(_inArray(this,i)<0){i.push(this)}})});return i}t=t||document;function d(e){if(typeof e!="string"){return e}return e.replace(/([^\w\-])/g,"\\$1")}function c(e){return e.replace(/\\/g,"")}function u(e,t){return e==="*"||e.toLowerCase()===d(t.toLowerCase())}function f(e,t,n){var i=[],a=n.ownerDocument||n,r=a.getElementById(c(e));if(r){if(u(t,r.nodeName)&&_contains(n,r)){i.push(r)}}return i}function p(e,t,n){var i=n.ownerDocument||n,a=[],r,o,l,s;if(n.getElementsByClassName){r=n.getElementsByClassName(c(e));for(o=0,l=r.length;o<l;o++){s=r[o];if(u(t,s.nodeName)){a.push(s)}}}else if(i.querySelectorAll){r=i.querySelectorAll((n.nodeName!=="#document"?n.nodeName+" ":"")+t+"."+e);for(o=0,l=r.length;o<l;o++){s=r[o];if(_contains(n,s)){a.push(s)}}}else{r=n.getElementsByTagName(t);e=" "+e+" ";for(o=0,l=r.length;o<l;o++){s=r[o];if(s.nodeType==1){var d=s.className;if(d&&(" "+d+" ").indexOf(e)>-1){a.push(s)}}}}return a}function h(e,t,n){var i=[],a=n.ownerDocument||n,r=a.getElementsByName(c(e)),o;for(var l=0,s=r.length;l<s;l++){o=r[l];if(u(t,o.nodeName)&&_contains(n,o)){if(o.getAttribute("name")!==null){i.push(o)}}}return i}function m(e,t,n,i){var a=[],r=i.getElementsByTagName(n),o;for(var l=0,s=r.length;l<s;l++){o=r[l];if(o.nodeType==1){if(t===null){if(_getAttr(o,e)!==null){a.push(o)}}else{if(t===d(_getAttr(o,e))){a.push(o)}}}}return a}function a(e,t){var n=[],i;i=/^((?:\\.|[^.#\s\[<>])+)/.exec(e);var a=i?i[1]:"*";if(i=/#((?:[\w\-]|\\.)+)$/.exec(e)){n=f(i[1],a,t)}else if(i=/\.((?:[\w\-]|\\.)+)$/.exec(e)){n=p(i[1],a,t)}else if(i=/\[((?:[\w\-]|\\.)+)\]/.exec(e)){n=m(i[1].toLowerCase(),null,a,t)}else if(i=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(e)){var r=i[1].toLowerCase(),o=i[2];if(r==="id"){n=f(o,a,t)}else if(r==="class"){n=p(o,a,t)}else if(r==="name"){n=h(o,a,t)}else{n=m(r,o,a,t)}}else{var l=t.getElementsByTagName(a),s;for(var d=0,c=l.length;d<c;d++){s=l[d];if(s.nodeType==1){n.push(s)}}}return n}var r=[],o,l=/((?:\\.|[^\s>])+|[\s>])/g;while(o=l.exec(e)){if(o[1]!==" "){r.push(o[1])}}var s=[];if(r.length==1){return a(r[0],t)}var g=false,v,_,b,k,y,w,C,x,T,E,K;for(w=0,lenth=r.length;w<lenth;w++){v=r[w];if(v===">"){g=true;continue}if(w>0){_=[];for(C=0,E=s.length;C<E;C++){k=s[C];b=a(v,k);for(x=0,K=b.length;x<K;x++){y=b[x];if(g){if(k===y.parentNode){_.push(y)}}else{_.push(y)}}}s=_}else{s=a(v,t)}if(s.length===0){return[]}}return s}function _query(e,t){var n=_queryAll(e,t);return n.length>0?n[0]:null}K.query=_query;K.queryAll=_queryAll;function _get(e){return K(e)[0]}function _getDoc(e){if(!e){return document}return e.ownerDocument||e.document||e}function _getWin(e){if(!e){return window}var t=_getDoc(e);return t.parentWindow||t.defaultView}function _setHtml(e,t){if(e.nodeType!=1){return}var n=_getDoc(e);try{e.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var i=n.getElementById("__kindeditor_temp_tag__");i.parentNode.removeChild(i)}catch(i){K(e).empty();K("@"+t,n).each(function(){e.appendChild(this)})}}function _hasClass(e,t){return _inString(t,e.className," ")}function _setAttr(e,t,n){if(_IE&&_V<8&&t.toLowerCase()=="class"){t="className"}e.setAttribute(t,""+n)}function _removeAttr(e,t){if(_IE&&_V<8&&t.toLowerCase()=="class"){t="className"}_setAttr(e,t,"");e.removeAttribute(t)}function _getNodeName(e){if(!e||!e.nodeName){return""}return e.nodeName.toLowerCase()}function _computedCss(e,t){var n=this,i=_getWin(e),a=_toCamel(t),r="";if(i.getComputedStyle){var o=i.getComputedStyle(e,null);r=o[a]||o.getPropertyValue(t)||e.style[a]}else if(e.currentStyle){r=e.currentStyle[a]||e.style[a]}return r}function _hasVal(e){return!!_VALUE_TAG_MAP[_getNodeName(e)]}function _docElement(e){e=e||document;return _QUIRKS?e.body:e.documentElement}function _docHeight(e){var t=_docElement(e);return Math.max(t.scrollHeight,t.clientHeight)}function _docWidth(e){var t=_docElement(e);return Math.max(t.scrollWidth,t.clientWidth)}function _getScrollPos(e){e=e||document;var t,n;if(_IE||_NEWIE||_OPERA){t=_docElement(e).scrollLeft;n=_docElement(e).scrollTop}else{t=_getWin(e).scrollX;n=_getWin(e).scrollY}return{x:t,y:n}}function KNode(e){this.init(e)}_extend(KNode,{init:function(e){var t=this;e=_isArray(e)?e:[e];var n=0;for(var i=0,a=e.length;i<a;i++){if(e[i]){t[i]=e[i].constructor===KNode?e[i][0]:e[i];n++}}t.length=n;t.doc=_getDoc(t[0]);t.name=_getNodeName(t[0]);t.type=t.length>0?t[0].nodeType:null;t.win=_getWin(t[0])},each:function(e){var t=this;for(var n=0;n<t.length;n++){if(e.call(t[n],n,t[n])===false){return t}}return t},bind:function(e,t){this.each(function(){_bind(this,e,t)});return this},unbind:function(e,t){this.each(function(){_unbind(this,e,t)});return this},fire:function(e){if(this.length<1){return this}_fire(this[0],e);return this},hasAttr:function(e){if(this.length<1){return false}return!!_getAttr(this[0],e)},attr:function(e,t){var n=this;if(e===undefined){return _getAttrList(n.outer())}if(typeof e==="object"){_each(e,function(e,t){n.attr(e,t)});return n}if(t===undefined){t=n.length<1?null:_getAttr(n[0],e);return t===null?"":t}n.each(function(){_setAttr(this,e,t)});return n},removeAttr:function(e){this.each(function(){_removeAttr(this,e)});return this},get:function(e){if(this.length<1){return null}return this[e||0]},eq:function(e){if(this.length<1){return null}return this[e]?new KNode(this[e]):null},hasClass:function(e){if(this.length<1){return false}return _hasClass(this[0],e)},addClass:function(e){this.each(function(){if(!_hasClass(this,e)){this.className=_trim(this.className+" "+e)}});return this},removeClass:function(e){this.each(function(){if(_hasClass(this,e)){this.className=_trim(this.className.replace(new RegExp("(^|\\s)"+e+"(\\s|$)")," "))}});return this},html:function(e){var t=this;if(e===undefined){if(t.length<1||t.type!=1){return""}return _formatHtml(t[0].innerHTML)}t.each(function(){_setHtml(this,e)});return t},text:function(){var e=this;if(e.length<1){return""}return _IE?e[0].innerText:e[0].textContent},hasVal:function(){if(this.length<1){return false}return _hasVal(this[0])},val:function(e){var t=this;if(e===undefined){if(t.length<1){return""}return t.hasVal()?t[0].value:t.attr("value")}else{t.each(function(){if(_hasVal(this)){this.value=e}else{_setAttr(this,"value",e)}});return t}},css:function(e,t){var n=this;if(e===undefined){return _getCssList(n.attr("style"))}if(typeof e==="object"){_each(e,function(e,t){n.css(e,t)});return n}if(t===undefined){if(n.length<1){return""}return n[0].style[_toCamel(e)]||_computedCss(n[0],e)||""}n.each(function(){this.style[_toCamel(e)]=t});return n},width:function(e){var t=this;if(e===undefined){if(t.length<1){return 0}return t[0].offsetWidth}return t.css("width",_addUnit(e))},height:function(e){var t=this;if(e===undefined){if(t.length<1){return 0}return t[0].offsetHeight}return t.css("height",_addUnit(e))},opacity:function(e){this.each(function(){if(this.style.opacity===undefined){this.style.filter=e==1?"":"alpha(opacity="+e*100+")"}else{this.style.opacity=e==1?"":e}});return this},data:function(e,t){var n=this;e="kindeditor_data_"+e;if(t===undefined){if(n.length<1){return null}return n[0][e]}this.each(function(){this[e]=t});return n},pos:function(){var e=this,t=e[0],n=0,i=0;if(t){if(t.getBoundingClientRect){var a=t.getBoundingClientRect(),r=_getScrollPos(e.doc);n=a.left+r.x;i=a.top+r.y}else{while(t){n+=t.offsetLeft;i+=t.offsetTop;t=t.offsetParent}}}return{x:_round(n),y:_round(i)}},clone:function(e){if(this.length<1){return new KNode([])}return new KNode(this[0].cloneNode(e))},append:function(e){this.each(function(){if(this.appendChild){this.appendChild(_get(e))}});return this},appendTo:function(e){this.each(function(){_get(e).appendChild(this)});return this},before:function(e){this.each(function(){this.parentNode.insertBefore(_get(e),this)});return this},after:function(e){this.each(function(){if(this.nextSibling){this.parentNode.insertBefore(_get(e),this.nextSibling)}else{this.parentNode.appendChild(_get(e))}});return this},replaceWith:function(i){var a=[];this.each(function(e,t){_unbind(t);var n=_get(i);t.parentNode.replaceChild(n,t);a.push(n)});return K(a)},empty:function(){var e=this;e.each(function(e,t){var n=t.firstChild;while(n){if(!t.parentNode){return}var i=n.nextSibling;n.parentNode.removeChild(n);n=i}});return e},remove:function(a){var r=this;r.each(function(e,t){if(!t.parentNode){return}_unbind(t);if(a){var n=t.firstChild;while(n){var i=n.nextSibling;t.parentNode.insertBefore(n,t);n=i}}t.parentNode.removeChild(t);delete r[e]});r.length=0;return r},show:function(e){var t=this;if(e===undefined){e=t._originDisplay||""}if(t.css("display")!="none"){return t}return t.css("display",e)},hide:function(){var e=this;if(e.length<1){return e}e._originDisplay=e[0].style.display;return e.css("display","none")},outer:function(){var e=this;if(e.length<1){return""}var t=e.doc.createElement("div"),n;t.appendChild(e[0].cloneNode(true));n=_formatHtml(t.innerHTML);t=null;return n},isSingle:function(){return!!_SINGLE_TAG_MAP[this.name]},isInline:function(){return!!_INLINE_TAG_MAP[this.name]},isBlock:function(){return!!_BLOCK_TAG_MAP[this.name]},isStyle:function(){return!!_STYLE_TAG_MAP[this.name]},isControl:function(){return!!_CONTROL_TAG_MAP[this.name]},contains:function(e){if(this.length<1){return false}return _contains(this[0],_get(e))},parent:function(){if(this.length<1){return null}var e=this[0].parentNode;return e?new KNode(e):null},children:function(){if(this.length<1){return new KNode([])}var e=[],t=this[0].firstChild;while(t){if(t.nodeType!=3||_trim(t.nodeValue)!==""){e.push(t)}t=t.nextSibling}return new KNode(e)},first:function(){var e=this.children();return e.length>0?e.eq(0):null},last:function(){var e=this.children();return e.length>0?e.eq(e.length-1):null},index:function(){if(this.length<1){return-1}var e=-1,t=this[0];while(t){e++;t=t.previousSibling}return e},prev:function(){if(this.length<1){return null}var e=this[0].previousSibling;return e?new KNode(e):null},next:function(){if(this.length<1){return null}var e=this[0].nextSibling;return e?new KNode(e):null},scan:function(i,a){if(this.length<1){return}a=a===undefined?true:a;function r(e){var t=a?e.firstChild:e.lastChild;while(t){var n=a?t.nextSibling:t.previousSibling;if(i(t)===false){return false}if(r(t)===false){return false}t=n}}r(this[0]);return this}});_each("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","),function(e,t){KNode.prototype[t]=function(e){return e?this.bind(t,e):this.fire(t)}});var _K=K;K=function(e,t){if(e===undefined||e===null){return}function n(e){if(!e[0]){e=[]}return new KNode(e)}if(typeof e==="string"){if(t){t=_get(t)}var i=e.length;if(e.charAt(0)==="@"){e=e.substr(1)}if(e.length!==i||/<.+>/.test(e)){var a=t?t.ownerDocument||t:document,r=a.createElement("div"),o=[];r.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+e;for(var l=0,s=r.childNodes.length;l<s;l++){var d=r.childNodes[l];if(d.id=="__kindeditor_temp_tag__"){continue}o.push(d)}return n(o)}return n(_queryAll(e,t))}if(e&&e.constructor===KNode){return e}if(e.toArray){e=e.toArray()}if(_isArray(e)){return n(e)}return n(_toArray(arguments))};_each(_K,function(e,t){K[e]=t});K.NodeClass=KNode;window.KindEditor=K;var _START_TO_START=0,_START_TO_END=1,_END_TO_END=2,_END_TO_START=3,_BOOKMARK_ID=0;function _updateCollapsed(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;return e}function _copyAndDelete(s,d,c){var l=s.doc,u=[];function f(e,t,n){var i=e.nodeValue.length,a;if(d){var r=e.cloneNode(true);if(t>0){a=r.splitText(t)}else{a=r}if(n<i){a.splitText(n-t)}}if(c){var o=e;if(t>0){o=e.splitText(t);s.setStart(e,t)}if(n<i){var l=o.splitText(n-t);s.setEnd(l,0)}u.push(o)}return a}function e(){if(c){s.up().collapse(true)}for(var e=0,t=u.length;e<t;e++){var n=u[e];if(n.parentNode){n.parentNode.removeChild(n)}}}var p=s.cloneRange().down();var h=-1,m=-1,g=-1,v=-1,t=s.commonAncestor(),n=l.createDocumentFragment();if(t.nodeType==3){var i=f(t,s.startOffset,s.endOffset);if(d){n.appendChild(i)}e();return d?n:s}function _(e,t){var n=e.firstChild,i;while(n){var a=new KRange(l).selectNode(n);h=a.compareBoundaryPoints(_START_TO_END,s);if(h>=0&&m<=0){m=a.compareBoundaryPoints(_START_TO_START,s)}if(m>=0&&g<=0){g=a.compareBoundaryPoints(_END_TO_END,s)}if(g>=0&&v<=0){v=a.compareBoundaryPoints(_END_TO_START,s)}if(v>=0){return false}i=n.nextSibling;if(h>0){if(n.nodeType==1){if(m>=0&&g<=0){if(d){t.appendChild(n.cloneNode(true))}if(c){u.push(n)}}else{var r;if(d){r=n.cloneNode(false);t.appendChild(r)}if(_(n,r)===false){return false}}}else if(n.nodeType==3){var o;if(n==p.startContainer){o=f(n,p.startOffset,n.nodeValue.length)}else if(n==p.endContainer){o=f(n,0,p.endOffset)}else{o=f(n,0,n.nodeValue.length)}if(d){try{t.appendChild(o)}catch(e){}}}}n=i}}_(t,n);if(c){s.up().collapse(true)}for(var a=0,r=u.length;a<r;a++){var o=u[a];if(o.parentNode){o.parentNode.removeChild(o)}}return d?n:s}function _moveToElementText(e,t){var n=t;while(n){var i=K(n);if(i.name=="marquee"||i.name=="select"){return}n=n.parentNode}try{e.moveToElementText(t)}catch(e){}}function _getStartEnd(e,t){var n=e.parentElement().ownerDocument,i=e.duplicate();i.collapse(t);var a=i.parentElement(),r=a.childNodes;if(r.length===0){return{node:a.parentNode,offset:K(a).index()}}var o=n,l=0,s=-1;var d=e.duplicate();_moveToElementText(d,a);for(var c=0,u=r.length;c<u;c++){var f=r[c];s=d.compareEndPoints("StartToStart",i);if(s===0){return{node:f.parentNode,offset:c}}if(f.nodeType==1){var p=e.duplicate(),h,m=K(f),g=f;if(m.isControl()){h=n.createElement("span");m.after(h);g=h;l+=m.text().replace(/\r\n|\n|\r/g,"").length}_moveToElementText(p,g);d.setEndPoint("StartToEnd",p);if(s>0){l+=p.text.replace(/\r\n|\n|\r/g,"").length}else{l=0}if(h){K(h).remove()}}else if(f.nodeType==3){d.moveStart("character",f.nodeValue.length);l+=f.nodeValue.length}if(s<0){o=f}}if(s<0&&o.nodeType==1){return{node:a,offset:K(a.lastChild).index()+1}}if(s>0){while(o.nextSibling&&o.nodeType==1){o=o.nextSibling}}d=e.duplicate();_moveToElementText(d,a);d.setEndPoint("StartToEnd",i);l-=d.text.replace(/\r\n|\n|\r/g,"").length;if(s>0&&o.nodeType==3){var v=o.previousSibling;while(v&&v.nodeType==3){l-=v.nodeValue.length;v=v.previousSibling}}return{node:o,offset:l}}function _getEndRange(e,t){var n=e.ownerDocument||e,i=n.body.createTextRange();if(n==e){i.collapse(true);return i}if(e.nodeType==1&&e.childNodes.length>0){var a=e.childNodes,r,o;if(t===0){o=a[0];r=true}else{o=a[t-1];r=false}if(!o){return i}if(K(o).name==="head"){if(t===1){r=true}if(t===2){r=false}i.collapse(r);return i}if(o.nodeType==1){var l=K(o),s;if(l.isControl()){s=n.createElement("span");if(r){l.before(s)}else{l.after(s)}o=s}_moveToElementText(i,o);i.collapse(r);if(s){K(s).remove()}return i}e=o;t=r?0:o.nodeValue.length}var d=n.createElement("span");K(e).before(d);_moveToElementText(i,d);i.moveStart("character",t);K(d).remove();return i}function _toRange(e){var t,n;function i(e){if(K(e.node).name=="tr"){e.node=e.node.cells[e.offset];e.offset=0}}if(_IERANGE){if(e.item){t=_getDoc(e.item(0));n=new KRange(t);n.selectNode(e.item(0));return n}t=e.parentElement().ownerDocument;var a=_getStartEnd(e,true),r=_getStartEnd(e,false);i(a);i(r);n=new KRange(t);n.setStart(a.node,a.offset);n.setEnd(r.node,r.offset);return n}var o=e.startContainer;t=o.ownerDocument||o;n=new KRange(t);n.setStart(o,e.startOffset);n.setEnd(e.endContainer,e.endOffset);return n}function KRange(e){this.init(e)}_extend(KRange,{init:function(e){var t=this;t.startContainer=e;t.startOffset=0;t.endContainer=e;t.endOffset=0;t.collapsed=true;t.doc=e},commonAncestor:function(){function e(e){var t=[];while(e){t.push(e);e=e.parentNode}return t}var t=e(this.startContainer),n=e(this.endContainer),i=0,a=t.length,r=n.length,o,l;while(++i){o=t[a-i];l=n[r-i];if(!o||!l||o!==l){break}}return t[a-i+1]},setStart:function(e,t){var n=this,i=n.doc;n.startContainer=e;n.startOffset=t;if(n.endContainer===i){n.endContainer=e;n.endOffset=t}return _updateCollapsed(this)},setEnd:function(e,t){var n=this,i=n.doc;n.endContainer=e;n.endOffset=t;if(n.startContainer===i){n.startContainer=e;n.startOffset=t}return _updateCollapsed(this)},setStartBefore:function(e){return this.setStart(e.parentNode||this.doc,K(e).index())},setStartAfter:function(e){return this.setStart(e.parentNode||this.doc,K(e).index()+1)},setEndBefore:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index())},setEndAfter:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index()+1)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){var t=K(e);if(t.type==3||t.isSingle()){return this.selectNode(e)}var n=t.children();if(n.length>0){return this.setStartBefore(n[0]).setEndAfter(n[n.length-1])}return this.setStart(e,0).setEnd(e,0)},collapse:function(e){if(e){return this.setEnd(this.startContainer,this.startOffset)}return this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(e,t){var n=this.get(),i=t.get();if(_IERANGE){var a={};a[_START_TO_START]="StartToStart";a[_START_TO_END]="EndToStart";a[_END_TO_END]="EndToEnd";a[_END_TO_START]="StartToEnd";var r=n.compareEndPoints(a[e],i);if(r!==0){return r}var o,l,s,d,c;if(e===_START_TO_START||e===_END_TO_START){o=this.startContainer;d=this.startOffset}if(e===_START_TO_END||e===_END_TO_END){o=this.endContainer;d=this.endOffset}if(e===_START_TO_START||e===_START_TO_END){l=t.startContainer;c=t.startOffset}if(e===_END_TO_END||e===_END_TO_START){l=t.endContainer;c=t.endOffset}if(o===l){var u=d-c;return u>0?1:u<0?-1:0}s=l;while(s&&s.parentNode!==o){s=s.parentNode}if(s){return K(s).index()>=d?-1:1}s=o;while(s&&s.parentNode!==l){s=s.parentNode}if(s){return K(s).index()>=c?1:-1}s=K(l).next();if(s&&s.contains(o)){return 1}s=K(o).next();if(s&&s.contains(l)){return-1}}else{return n.compareBoundaryPoints(e,i)}},cloneRange:function(){return new KRange(this.doc).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var e=this.get(),t=_IERANGE?e.text:e.toString();return t.replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return _copyAndDelete(this,true,false)},deleteContents:function(){return _copyAndDelete(this,false,true)},extractContents:function(){return _copyAndDelete(this,true,true)},insertNode:function(e){var t=this,n=t.startContainer,i=t.startOffset,a=t.endContainer,r=t.endOffset,o,l,s,d=1;if(e.nodeName.toLowerCase()==="#document-fragment"){o=e.firstChild;l=e.lastChild;d=e.childNodes.length}if(n.nodeType==1){s=n.childNodes[i];if(s){n.insertBefore(e,s);if(n===a){r+=d}}else{n.appendChild(e)}}else if(n.nodeType==3){if(i===0){n.parentNode.insertBefore(e,n);if(n.parentNode===a){r+=d}}else if(i>=n.nodeValue.length){if(n.nextSibling){n.parentNode.insertBefore(e,n.nextSibling)}else{n.parentNode.appendChild(e)}}else{if(i>0){s=n.splitText(i)}else{s=n}n.parentNode.insertBefore(e,s);if(n===a){a=s;r-=i}}}if(o){t.setStartBefore(o).setEndAfter(l)}else{t.selectNode(e)}if(t.compareBoundaryPoints(_END_TO_END,t.cloneRange().setEnd(a,r))>=1){return t}return t.setEnd(a,r)},surroundContents:function(e){e.appendChild(this.extractContents());return this.insertNode(e).selectNode(e)},isControl:function(){var e=this,t=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,r;return t.nodeType==1&&t===i&&n+1===a&&K(t.childNodes[n]).isControl()},get:function(e){var t=this,n=t.doc,i,a;if(!_IERANGE){a=n.createRange();try{a.setStart(t.startContainer,t.startOffset);a.setEnd(t.endContainer,t.endOffset)}catch(e){}return a}if(e&&t.isControl()){a=n.body.createControlRange();a.addElement(t.startContainer.childNodes[t.startOffset]);return a}var r=t.cloneRange().down();a=n.body.createTextRange();a.setEndPoint("StartToStart",_getEndRange(r.startContainer,r.startOffset));a.setEndPoint("EndToStart",_getEndRange(r.endContainer,r.endOffset));return a},html:function(){return K(this.cloneContents()).outer()},down:function(){var s=this;function e(e,t,n){if(e.nodeType!=1){return}var i=K(e).children();if(i.length===0){return}var a,r,o,l;if(t>0){a=i.eq(t-1)}if(t<i.length){r=i.eq(t)}if(a&&a.type==3){o=a[0];l=o.nodeValue.length}if(r&&r.type==3){o=r[0];l=0}if(!o){return}if(n){s.setStart(o,l)}else{s.setEnd(o,l)}}e(s.startContainer,s.startOffset,true);e(s.endContainer,s.endOffset,false);return s},up:function(){var i=this;function e(e,t,n){if(e.nodeType!=3){return}if(t===0){if(n){i.setStartBefore(e)}else{i.setEndBefore(e)}}else if(t==e.nodeValue.length){if(n){i.setStartAfter(e)}else{i.setEndAfter(e)}}}e(i.startContainer,i.startOffset,true);e(i.endContainer,i.endOffset,false);return i},enlarge:function(r){var o=this;o.up();function e(e,t,n){var i=K(e),a;if(i.type==3||_NOSPLIT_TAG_MAP[i.name]||!r&&i.isBlock()){return}if(t===0){while(!i.prev()){a=i.parent();if(!a||_NOSPLIT_TAG_MAP[a.name]||!r&&a.isBlock()){break}i=a}if(n){o.setStartBefore(i[0])}else{o.setEndBefore(i[0])}}else if(t==i.children().length){while(!i.next()){a=i.parent();if(!a||_NOSPLIT_TAG_MAP[a.name]||!r&&a.isBlock()){break}i=a}if(n){o.setStartAfter(i[0])}else{o.setEndAfter(i[0])}}}e(o.startContainer,o.startOffset,true);e(o.endContainer,o.endOffset,false);return o},shrink:function(){var e=this,t,n=e.collapsed;while(e.startContainer.nodeType==1&&(t=e.startContainer.childNodes[e.startOffset])&&t.nodeType==1&&!K(t).isSingle()){e.setStart(t,0)}if(n){return e.collapse(n)}while(e.endContainer.nodeType==1&&e.endOffset>0&&(t=e.endContainer.childNodes[e.endOffset-1])&&t.nodeType==1&&!K(t).isSingle()){e.setEnd(t,t.childNodes.length)}return e},createBookmark:function(e){var t=this,n=t.doc,i,a=K('<span style="display:none;"></span>',n)[0];a.id="__kindeditor_bookmark_start_"+_BOOKMARK_ID+++"__";if(!t.collapsed){i=a.cloneNode(true);i.id="__kindeditor_bookmark_end_"+_BOOKMARK_ID+++"__"}if(i){t.cloneRange().collapse(false).insertNode(i).setEndBefore(i)}t.insertNode(a).setStartAfter(a);return{start:e?"#"+a.id:a,end:i?e?"#"+i.id:i:null}},moveToBookmark:function(e){var t=this,n=t.doc,i=K(e.start,n),a=e.end?K(e.end,n):null;if(!i||i.length<1){return t}t.setStartBefore(i[0]);i.remove();if(a&&a.length>0){t.setEndBefore(a[0]);a.remove()}else{t.collapse(true)}return t},dump:function(){console.log("--------------------");console.log(this.startContainer.nodeType==3?this.startContainer.nodeValue:this.startContainer,this.startOffset);console.log(this.endContainer.nodeType==3?this.endContainer.nodeValue:this.endContainer,this.endOffset)}});function _range(e){if(!e.nodeName){return e.constructor===KRange?e:_toRange(e)}return new KRange(e)}K.RangeClass=KRange;K.range=_range;K.START_TO_START=_START_TO_START;K.START_TO_END=_START_TO_END;K.END_TO_END=_END_TO_END;K.END_TO_START=_END_TO_START;function _nativeCommand(e,t,n){try{e.execCommand(t,false,n)}catch(e){}}function _nativeCommandValue(e,t){var n="";try{n=e.queryCommandValue(t)}catch(e){}if(typeof n!=="string"){n=""}return n}function _getSel(e){var t=_getWin(e);return _IERANGE?e.selection:t.getSelection()}function _getRng(e){var t=_getSel(e),n;try{if(t.rangeCount>0){n=t.getRangeAt(0)}else{n=t.createRange()}}catch(e){}if(_IERANGE&&(!n||!n.item&&n.parentElement().ownerDocument!==e)){return null}return n}function _singleKeyMap(e){var a={},r,o;_each(e,function(e,t){r=e.split(",");for(var n=0,i=r.length;n<i;n++){o=r[n];a[o]=t}});return a}function _hasAttrOrCss(e,t){return _hasAttrOrCssByKey(e,t,"*")||_hasAttrOrCssByKey(e,t)}function _hasAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1){return false}var i=_singleKeyMap(t);if(!i[n]){return false}var a=i[n].split(",");for(var r=0,o=a.length;r<o;r++){var l=a[r];if(l==="*"){return true}var s=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(l);var d=s[1]?"css":"attr";l=s[2];var c=s[3]||"";if(c===""&&e[d](l)!==""){return true}if(c!==""&&e[d](l)===c){return true}}return false}function _removeAttrOrCss(e,t){if(e.type!=1){return}_removeAttrOrCssByKey(e,t,"*");_removeAttrOrCssByKey(e,t)}function _removeAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1){return}var i=_singleKeyMap(t);if(!i[n]){return}var a=i[n].split(","),r=false;for(var o=0,l=a.length;o<l;o++){var s=a[o];if(s==="*"){r=true;break}var d=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(s);s=d[2];if(d[1]){s=_toCamel(s);if(e[0].style[s]){e[0].style[s]=""}}else{e.removeAttr(s)}}if(r){e.remove(true)}}function _getInnerNode(e){var t=e;while(t.first()){t=t.first()}return t}function _isEmptyNode(e){if(e.type!=1||e.isSingle()){return false}return e.html().replace(/<[^>]+>/g,"")===""}function _mergeWrapper(e,t){e=e.clone(true);var n=_getInnerNode(e),i=e,a=false;while(t){while(i){if(i.name===t.name){_mergeAttrs(i,t.attr(),t.css());a=true}i=i.first()}if(!a){n.append(t.clone(false))}a=false;t=t.first()}return e}function _wrapNode(e,t){t=t.clone(true);if(e.type==3){_getInnerNode(t).append(e.clone(false));e.replaceWith(t);return t}var n=e,i;while((i=e.first())&&i.children().length==1){e=i}i=e.first();var a=e.doc.createDocumentFragment();while(i){a.appendChild(i[0]);i=i.next()}t=_mergeWrapper(n,t);if(a.firstChild){_getInnerNode(t).append(a)}n.replaceWith(t);return t}function _mergeAttrs(n,e,t){_each(e,function(e,t){if(e!=="style"){n.attr(e,t)}});_each(t,function(e,t){n.css(e,t)})}function _inPreElement(e){while(e&&e.name!="body"){if(_PRE_TAG_MAP[e.name]||e.name=="div"&&e.hasClass("ke-script")){return true}e=e.parent()}return false}function KCmd(e){this.init(e)}_extend(KCmd,{init:function(e){var t=this,n=e.doc;t.doc=n;t.win=_getWin(n);t.sel=_getSel(n);t.range=e},selection:function(e){var t=this,n=t.doc,i=_getRng(n);t.sel=_getSel(n);if(i){t.range=_range(i);if(K(t.range.startContainer).name=="html"){t.range.selectNodeContents(n.body).collapse(false)}return t}if(e){t.range.selectNodeContents(n.body).collapse(false)}return t},select:function(e){e=_undef(e,true);var t=this,n=t.sel,i=t.range.cloneRange().shrink(),a=i.startContainer,r=i.startOffset,o=i.endContainer,l=i.endOffset,s=_getDoc(a),d=t.win,c,u=false;if(e&&a.nodeType==1&&i.collapsed){if(_IERANGE){var f=K("<span>&nbsp;</span>",s);i.insertNode(f[0]);c=s.body.createTextRange();try{c.moveToElementText(f[0])}catch(e){}c.collapse(false);c.select();f.remove();d.focus();return t}if(_WEBKIT){var p=a.childNodes;if(K(a).isInline()||r>0&&K(p[r-1]).isInline()||p[r]&&K(p[r]).isInline()){i.insertNode(s.createTextNode("​"));u=true}}}if(_IERANGE){try{c=i.get(true);c.select()}catch(e){}}else{if(u){i.collapse(false)}c=i.get(true);n.removeAllRanges();n.addRange(c);if(s!==document){var h=K(c.endContainer).pos();d.scrollTo(h.x,h.y)}}d.focus();return t},wrap:function(e){var t=this,n=t.doc,i=t.range,a;a=K(e,n);if(i.collapsed){i.shrink();i.insertNode(a[0]).selectNodeContents(a[0]);return t}if(a.isBlock()){var r=a.clone(true),o=r;while(o.first()){o=o.first()}o.append(i.extractContents());i.insertNode(r[0]).selectNode(r[0]);return t}i.enlarge();var l=i.createBookmark(),s=i.commonAncestor(),d=false;K(s).scan(function(e){if(!d&&e==l.start){d=true;return}if(d){if(e==l.end){return false}var t=K(e);if(_inPreElement(t)){return}if(t.type==3&&_trim(e.nodeValue).length>0){var n;while((n=t.parent())&&n.isStyle()&&n.children().length==1){t=n}_wrapNode(t,a)}}});i.moveToBookmark(l);return t},split:function(e,t){var n=this.range,i=n.doc;var a=n.cloneRange().collapse(e);var r=a.startContainer,o=a.startOffset,l=r.nodeType==3?r.parentNode:r,s=false,d;while(l&&l.parentNode){d=K(l);if(t){if(!d.isStyle()){break}if(!_hasAttrOrCss(d,t)){break}}else{if(_NOSPLIT_TAG_MAP[d.name]){break}}s=true;l=l.parentNode}if(s){var c=i.createElement("span");n.cloneRange().collapse(!e).insertNode(c);if(e){a.setStartBefore(l.firstChild).setEnd(r,o)}else{a.setStart(r,o).setEndAfter(l.lastChild)}var u=a.extractContents(),f=u.firstChild,p=u.lastChild;if(e){a.insertNode(u);n.setStartAfter(p).setEndBefore(c)}else{l.appendChild(u);n.setStartBefore(c).setEndBefore(f)}var h=c.parentNode;if(h==n.endContainer){var m=K(c).prev(),g=K(c).next();if(m&&g&&m.type==3&&g.type==3){n.setEnd(m[0],m[0].nodeValue.length)}else if(!e){n.setEnd(n.endContainer,n.endOffset-1)}}h.removeChild(c)}return this},remove:function(n){var e=this,t=e.doc,i=e.range;i.enlarge();if(i.startOffset===0){var a=K(i.startContainer),r;while((r=a.parent())&&r.isStyle()&&r.children().length==1){a=r}i.setStart(a[0],0);a=K(i.startContainer);if(a.isBlock()){_removeAttrOrCss(a,n)}var o=a.parent();if(o&&o.isBlock()){_removeAttrOrCss(o,n)}}var l,s;if(i.collapsed){e.split(true,n);l=i.startContainer;s=i.startOffset;if(s>0){var d=K(l.childNodes[s-1]);if(d&&_isEmptyNode(d)){d.remove();i.setStart(l,s-1)}}var c=K(l.childNodes[s]);if(c&&_isEmptyNode(c)){c.remove()}if(_isEmptyNode(l)){i.startBefore(l);l.remove()}i.collapse(true);return e}e.split(true,n);e.split(false,n);var u=t.createElement("span"),f=t.createElement("span");i.cloneRange().collapse(false).insertNode(f);i.cloneRange().collapse(true).insertNode(u);var p=[],h=false;K(i.commonAncestor()).scan(function(e){if(!h&&e==u){h=true;return}if(e==f){return false}if(h){p.push(e)}});K(u).remove();K(f).remove();l=i.startContainer;s=i.startOffset;var m=i.endContainer,g=i.endOffset;if(s>0){var v=K(l.childNodes[s-1]);if(v&&_isEmptyNode(v)){v.remove();i.setStart(l,s-1);if(l==m){i.setEnd(m,g-1)}}var _=K(l.childNodes[s]);if(_&&_isEmptyNode(_)){_.remove();if(l==m){i.setEnd(m,g-1)}}}var b=K(m.childNodes[i.endOffset]);if(b&&_isEmptyNode(b)){b.remove()}var k=i.createBookmark(true);_each(p,function(e,t){_removeAttrOrCss(K(t),n)});i.moveToBookmark(k);return e},commonNode:function(i){var e=this.range;var t=e.endContainer,n=e.endOffset,a=t.nodeType==3||n===0?t:t.childNodes[n-1];function r(e){var t=e,n=e;while(n){if(_hasAttrOrCss(K(n),i)){return K(n)}n=n.parentNode}while(t&&(t=t.lastChild)){if(_hasAttrOrCss(K(t),i)){return K(t)}}return null}var o=r(a);if(o){return o}if(a.nodeType==1||t.nodeType==3&&n===0){var l=K(a).prev();if(l){return r(l)}}return null},commonAncestor:function(t){var e=this.range,n=e.startContainer,i=e.startOffset,a=e.endContainer,r=e.endOffset,o=n.nodeType==3||i===0?n:n.childNodes[i-1],l=a.nodeType==3||r===0?a:a.childNodes[r-1];function s(e){while(e){if(e.nodeType==1){if(e.tagName.toLowerCase()===t){return e}}e=e.parentNode}return null}var d=s(o),c=s(l);if(d&&c&&d===c){return K(d)}return null},state:function(e){var t=this,n=t.doc,i=false;try{i=n.queryCommandState(e)}catch(e){}return i},val:function(e){var t=this,n=t.doc,i=t.range;function a(e){return e.toLowerCase()}e=a(e);var r="",o;if(e==="fontfamily"||e==="fontname"){r=_nativeCommandValue(n,"fontname");r=r.replace(/['"]/g,"");return a(r)}if(e==="formatblock"){r=_nativeCommandValue(n,e);if(r===""){o=t.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"});if(o){r=o.name}}if(r==="Normal"){r="p"}return a(r)}if(e==="fontsize"){o=t.commonNode({"*":".font-size"});if(o){r=o.css("font-size")}return a(r)}if(e==="forecolor"){o=t.commonNode({"*":".color"});if(o){r=o.css("color")}r=_toHex(r);if(r===""){r="default"}return a(r)}if(e==="hilitecolor"){o=t.commonNode({"*":".background-color"});if(o){r=o.css("background-color")}r=_toHex(r);if(r===""){r="default"}return a(r)}return r},toggle:function(e,t){var n=this;if(n.commonNode(t)){n.remove(t)}else{n.wrap(e)}return n.select()},bold:function(){return this.toggle("<strong></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",{span:".text-decoration=line-through",s:"*"})},forecolor:function(e){return this.wrap('<span style="color:'+e+';"></span>').select()},hilitecolor:function(e){return this.wrap('<span style="background-color:'+e+';"></span>').select()},fontsize:function(e){return this.wrap('<span style="font-size:'+e+';"></span>').select()},fontname:function(e){return this.fontfamily(e)},fontfamily:function(e){return this.wrap('<span style="font-family:'+e+';"></span>').select()},removeformat:function(){var n={"*":".font-weight,.font-style,.text-decoration,.color,.background-color,.font-size,.font-family,.text-indent"},e=_STYLE_TAG_MAP;_each(e,function(e,t){n[e]="*"});this.remove(n);return this.select()},inserthtml:function(e,t){var r=this,n=r.range;if(e===""){return r}function i(e,t){t='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var n=e.get();if(n.item){n.item(0).outerHTML=t}else{n.pasteHTML(t)}var i=e.doc.getElementById("__kindeditor_temp_tag__");i.parentNode.removeChild(i);var a=_toRange(n);e.setEnd(a.endContainer,a.endOffset);e.collapse(false);r.select(false)}function a(e,t){var n=e.doc,i=n.createDocumentFragment();K("@"+t,n).each(function(){i.appendChild(this)});e.deleteContents();e.insertNode(i);e.collapse(false);r.select(false)}if(_IERANGE&&t){try{i(n,e)}catch(t){a(n,e)}return r}a(n,e);return r},hr:function(){return this.inserthtml("<hr />")},print:function(){this.win.print();return this},insertimage:function(e,t,n,i,a,r){t=_undef(t,"");a=_undef(a,0);var o='<img src="'+_escape(e)+'" data-ke-src="'+_escape(e)+'" ';if(n){o+='width="'+_escape(n)+'" '}if(i){o+='height="'+_escape(i)+'" '}if(t){o+='title="'+_escape(t)+'" '}if(r){o+='align="'+_escape(r)+'" '}o+='alt="'+_escape(t)+'" ';o+="/>";return this.inserthtml(o)},createlink:function(e,t){var n=this,i=n.doc,a=n.range;n.select();var r=n.commonNode({a:"*"});if(r&&!a.isControl()){a.selectNode(r.get());n.select()}var o='<a href="'+_escape(e)+'" data-ke-src="'+_escape(e)+'" ';if(t){o+=' target="'+_escape(t)+'"'}if(a.collapsed){o+=">"+_escape(e)+"</a>";return n.inserthtml(o)}if(a.isControl()){var l=K(a.startContainer.childNodes[a.startOffset]);o+="></a>";l.after(K(o,i));l.next().append(l);a.selectNode(l[0]);return n.select()}function s(e,t,n){K(e).attr("href",t).attr("data-ke-src",t);if(n){K(e).attr("target",n)}else{K(e).removeAttr("target")}}var d=a.startContainer,c=a.startOffset,u=a.endContainer,f=a.endOffset;if(d.nodeType==1&&d===u&&c+1===f){var p=d.childNodes[c];if(p.nodeName.toLowerCase()=="a"){s(p,e,t);return n}}_nativeCommand(i,"createlink","__kindeditor_temp_url__");K('a[href="__kindeditor_temp_url__"]',i).each(function(){s(this,e,t)});return n},unlink:function(){var e=this,t=e.doc,n=e.range;e.select();if(n.collapsed){var i=e.commonNode({a:"*"});if(i){n.selectNode(i.get());e.select()}_nativeCommand(t,"unlink",null);if(_WEBKIT&&K(n.startContainer).name==="img"){var a=K(n.startContainer).parent();if(a.name==="a"){a.remove(true)}}}else{_nativeCommand(t,"unlink",null)}return e}});_each("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript".split(","),function(e,n){KCmd.prototype[n]=function(e){var t=this;t.select();_nativeCommand(t.doc,n,e);if(_IERANGE&&_inArray(n,"justifyleft,justifycenter,justifyright,justifyfull".split(","))>=0){t.selection()}if(!_IERANGE||_inArray(n,"formatblock,selectall,insertorderedlist,insertunorderedlist".split(","))>=0){t.selection()}return t}});_each("cut,copy,paste".split(","),function(e,t){KCmd.prototype[t]=function(){var e=this;if(!e.doc.queryCommandSupported(t)){throw"not supported"}e.select();_nativeCommand(e.doc,t,null);return e}});function _cmd(e){if(e.nodeName){var t=_getDoc(e);e=_range(t).selectNodeContents(t.body).collapse(false)}return new KCmd(e)}K.CmdClass=KCmd;K.cmd=_cmd;function _drag(e){var u=e.moveEl,f=e.moveFn,p=e.clickEl||u,h=e.beforeDrag,t=e.iframeFix===undefined?true:e.iframeFix;var m=[document];if(t){K("iframe").each(function(){var e=_formatUrl(this.src||"","absolute");if(/^https?:\/\//.test(e)){return}var t;try{t=_iframeDoc(this)}catch(e){}if(t){var n=K(this).pos();K(t).data("pos-x",n.x);K(t).data("pos-y",n.y);m.push(t)}})}p.mousedown(function(e){if(e.button!==0&&e.button!==1){return}e.stopPropagation();var t=p.get(),a=_removeUnit(u.css("left")),r=_removeUnit(u.css("top")),o=u.width(),l=u.height(),s=e.pageX,d=e.pageY;if(h){h()}function n(e){e.preventDefault();var t=K(_getDoc(e.target));var n=_round((t.data("pos-x")||0)+e.pageX-s);var i=_round((t.data("pos-y")||0)+e.pageY-d);f.call(p,a,r,o,l,n,i)}function i(e){e.preventDefault()}function c(e){e.preventDefault();K(m).unbind("mousemove",n).unbind("mouseup",c).unbind("selectstart",i);if(t.releaseCapture){t.releaseCapture()}}K(m).mousemove(n).mouseup(c).bind("selectstart",i);if(t.setCapture){t.setCapture()}})}function KWidget(e){this.init(e)}_extend(KWidget,{init:function(e){var a=this;a.name=e.name||"";a.doc=e.doc||document;a.win=_getWin(a.doc);a.x=_addUnit(e.x);a.y=_addUnit(e.y);a.z=e.z;a.width=_addUnit(e.width);a.height=_addUnit(e.height);a.div=K('<div style="display:block;"></div>');a.options=e;a._alignEl=e.alignEl;if(a.width){a.div.css("width",a.width)}if(a.height){a.div.css("height",a.height)}if(a.z){a.div.css({position:"absolute",left:a.x,top:a.y,"z-index":a.z})}if(a.z&&(a.x===undefined||a.y===undefined)){a.autoPos(a.width,a.height)}if(e.cls){a.div.addClass(e.cls)}if(e.shadowMode){a.div.addClass("ke-shadow")}if(e.css){a.div.css(e.css)}if(e.src){K(e.src).replaceWith(a.div)}else{K(a.doc.body).append(a.div)}if(e.html){a.div.html(e.html)}if(e.autoScroll){if(_IE&&_V<7||_QUIRKS){var r=_getScrollPos();K(a.win).bind("scroll",function(e){var t=_getScrollPos(),n=t.x-r.x,i=t.y-r.y;a.pos(_removeUnit(a.x)+n,_removeUnit(a.y)+i,false)})}else{a.div.css("position","fixed")}}},pos:function(e,t,n){var i=this;n=_undef(n,true);if(e!==null){e=e<0?0:_addUnit(e);i.div.css("left",e);if(n){i.x=e}}if(t!==null){t=t<0?0:_addUnit(t);i.div.css("top",t);if(n){i.y=t}}return i},autoPos:function(e,t){var n,i,a=this,r=_removeUnit(e)||0,o=_removeUnit(t)||0,l=_getScrollPos();if(a._alignEl){var s=K(a._alignEl),d=s.pos(),c=_round(s[0].clientWidth/2-r/2),u=_round(s[0].clientHeight/2-o/2);n=c<0?d.x:d.x+c;i=u<0?d.y:d.y+u}else{var f=_docElement(a.doc);n=_round(l.x+(f.clientWidth-r)/2);i=_round(l.y+(f.clientHeight-o)/2)}if(!(_IE&&_V<7||_QUIRKS)){n-=l.x;i-=l.y}return a.pos(n,i)},remove:function(){var t=this;if(_IE&&_V<7||_QUIRKS){K(t.win).unbind("scroll")}t.div.remove();_each(t,function(e){t[e]=null});return this},show:function(){this.div.show();return this},hide:function(){this.div.hide();return this},draggable:function(e){var o=this;e=e||{};e.moveEl=o.div;e.moveFn=function(e,t,n,i,a,r){if((e=e+a)<0){e=0}if((t=t+r)<0){t=0}o.pos(e,t)};_drag(e);return o}});function _widget(e){return new KWidget(e)}K.WidgetClass=KWidget;K.widget=_widget;function _iframeDoc(e){e=_get(e);return e.contentDocument||e.contentWindow.document}var html,_direction="";if(html=document.getElementsByTagName("html")){_direction=html[0].dir}function _getInitHtml(e,t,n,i){var a=[_direction===""?"<html>":'<html dir="'+_direction+'">','<head><meta charset="utf-8" /><title></title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:5px;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"body, p, div {word-wrap: break-word;}","p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}","img.ke-flash {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/flash.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-rm {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/rm.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-media {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/media.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-anchor {","\tborder:1px dashed #666;","\twidth:16px;","\theight:16px;","}",".ke-script, .ke-noscript, .ke-display-none {","\tdisplay:none;","\tfont-size:0;","\twidth:0;","\theight:0;","}",".ke-pagebreak {","\tborder:1px dotted #AAA;","\tfont-size:0;","\theight:2px;","}","</style>"];if(!_isArray(n)){n=[n]}_each(n,function(e,t){if(t){a.push('<link href="'+t+'" rel="stylesheet" />')}});if(i){a.push("<style>"+i+"</style>")}a.push("</head><body "+(t?'class="'+t+'"':"")+"></body></html>");return a.join("\n")}function _elementVal(e,t){if(e.hasVal()){if(t===undefined){var n=e.val();n=n.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"");return n}return e.val(t)}return e.html(t)}function KEdit(e){this.init(e)}_extend(KEdit,KWidget,{init:function(t){var i=this;KEdit.parent.init.call(i,t);i.srcElement=K(t.srcElement);i.div.addClass("ke-edit");i.designMode=_undef(t.designMode,true);i.beforeGetHtml=t.beforeGetHtml;i.beforeSetHtml=t.beforeSetHtml;i.afterSetHtml=t.afterSetHtml;var a=_undef(t.themesPath,""),r=t.bodyClass,o=t.cssPath,l=t.cssData,s=location.protocol!="res:"&&location.host.replace(/:\d+/,"")!==document.domain,e="document.open();"+(s?'document.domain="'+document.domain+'";':"")+"document.close();",n=_IE?' src="javascript:void(function(){'+encodeURIComponent(e)+'}())"':"";i.iframe=K('<iframe class="ke-edit-iframe" hidefocus="true" frameborder="0"'+n+"></iframe>").css("width","100%");i.textarea=K('<textarea class="ke-edit-textarea" hidefocus="true"></textarea>').css("width","100%");i.tabIndex=isNaN(parseInt(t.tabIndex,10))?i.srcElement.attr("tabindex"):parseInt(t.tabIndex,10);i.iframe.attr("tabindex",i.tabIndex);i.textarea.attr("tabindex",i.tabIndex);if(i.width){i.setWidth(i.width)}if(i.height){i.setHeight(i.height)}if(i.designMode){i.textarea.hide()}else{i.iframe.hide()}function d(){var e=_iframeDoc(i.iframe);e.open();if(s){e.domain=document.domain}e.write(_getInitHtml(a,r,o,l));e.close();i.win=i.iframe[0].contentWindow;i.doc=e;var n=_cmd(e);i.afterChange(function(e){n.selection()});if(_WEBKIT){K(e).click(function(e){if(K(e.target).name==="img"){n.selection(true);n.range.selectNode(e.target);n.select()}})}if(_IE){i._mousedownHandler=function(){var e=n.range.cloneRange();e.shrink();if(e.isControl()){i.blur()}};K(document).mousedown(i._mousedownHandler);K(e).keydown(function(e){if(e.which==8){n.selection();var t=n.range;if(t.isControl()){t.collapse(true);K(t.startContainer.childNodes[t.startOffset]).remove();e.preventDefault()}}})}i.cmd=n;i.html(_elementVal(i.srcElement));if(_IE){e.body.disabled=true;e.body.contentEditable=true;e.body.removeAttribute("disabled")}else{e.designMode="on"}if(t.afterCreate){t.afterCreate.call(i)}}if(s){i.iframe.bind("load",function(e){i.iframe.unbind("load");if(_IE){d()}else{setTimeout(d,0)}})}i.div.append(i.iframe);i.div.append(i.textarea);i.srcElement.hide();!s&&d()},setWidth:function(e){var t=this;e=_addUnit(e);t.width=e;t.div.css("width",e);return t},setHeight:function(e){var t=this;e=_addUnit(e);t.height=e;t.div.css("height",e);t.iframe.css("height",e);if(_IE&&_V<8||_QUIRKS){e=_addUnit(_removeUnit(e)-2)}t.textarea.css("height",e);return t},remove:function(){var e=this,t=e.doc;K(t.body).unbind();K(t).unbind();K(e.win).unbind();if(e._mousedownHandler){K(document).unbind("mousedown",e._mousedownHandler)}_elementVal(e.srcElement,e.html());e.srcElement.show();e.iframe.unbind();e.textarea.unbind();KEdit.parent.remove.call(e)},html:function(e,t){var n=this,i=n.doc;if(n.designMode){var a=i.body;if(e===undefined){if(t){e="<!doctype html><html>"+a.parentNode.innerHTML+"</html>"}else{e=a.innerHTML}if(n.beforeGetHtml){e=n.beforeGetHtml(e)}if(_GECKO&&e=="<br />"){e=""}return e}if(n.beforeSetHtml){e=n.beforeSetHtml(e)}if(_IE&&_V>=9){e=e.replace(/(<.*?checked=")checked(".*>)/gi,"$1$2")}K(a).html(e);if(n.afterSetHtml){n.afterSetHtml()}return n}if(e===undefined){return n.textarea.val()}n.textarea.val(e);return n},design:function(e){var t=this,n;if(e===undefined?!t.designMode:e){if(!t.designMode){n=t.html();t.designMode=true;t.textarea.hide();t.html(n);var i=t.iframe;var a=_removeUnit(t.height);i.height(a-2);i.show();setTimeout(function(){i.height(a)},0)}}else{if(t.designMode){n=t.html();t.designMode=false;t.html(n);t.iframe.hide();t.textarea.show()}}return t.focus()},focus:function(){var e=this;e.designMode?e.win.focus():e.textarea[0].focus();return e},blur:function(){var e=this;if(_IE){var t=K('<input type="text" style="float:left;width:0;height:0;padding:0;margin:0;border:0;" value="" />',e.div);e.div.append(t);t[0].focus();t.remove()}else{e.designMode?e.win.blur():e.textarea[0].blur()}return e},afterChange:function(t){var e=this,n=e.doc,i=n.body;K(n).keyup(function(e){if(!e.ctrlKey&&!e.altKey&&_CHANGE_KEY_MAP[e.which]){t(e)}});K(n).mouseup(t).contextmenu(t);K(e.win).blur(t);function a(e){setTimeout(function(){t(e)},1)}K(i).bind("paste",a);K(i).bind("cut",a);return e}});function _edit(e){return new KEdit(e)}K.EditClass=KEdit;K.edit=_edit;K.iframeDoc=_iframeDoc;function _selectToolbar(e,t){var n=this,i=n.get(e);if(i){if(i.hasClass("ke-disabled")){return}t(i)}}function KToolbar(e){this.init(e)}_extend(KToolbar,KWidget,{init:function(e){var n=this;KToolbar.parent.init.call(n,e);n.disableMode=_undef(e.disableMode,false);n.noDisableItemMap=_toMap(_undef(e.noDisableItems,[]));n._itemMap={};n.div.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()}).attr("unselectable","on");function i(e){var t=K(e);if(t.hasClass("ke-outline")){return t}if(t.hasClass("ke-toolbar-icon")){return t.parent()}}function t(e,t){var n=i(e.target);if(n){if(n.hasClass("ke-disabled")){return}if(n.hasClass("ke-selected")){return}n[t]("ke-on")}}n.div.mouseover(function(e){t(e,"addClass")}).mouseout(function(e){t(e,"removeClass")}).click(function(e){var t=i(e.target);if(t){if(t.hasClass("ke-disabled")){return}n.options.click.call(this,e,t.attr("data-name"))}})},get:function(e){if(this._itemMap[e]){return this._itemMap[e]}return this._itemMap[e]=K("span.ke-icon-"+e,this.div).parent()},select:function(e){_selectToolbar.call(this,e,function(e){e.addClass("ke-selected")});return self},unselect:function(e){_selectToolbar.call(this,e,function(e){e.removeClass("ke-selected").removeClass("ke-on")});return self},enable:function(e){var t=this,n=e.get?e:t.get(e);if(n){n.removeClass("ke-disabled");n.opacity(1)}return t},disable:function(e){var t=this,n=e.get?e:t.get(e);if(n){n.removeClass("ke-selected").addClass("ke-disabled");n.opacity(.5)}return t},disableAll:function(e,t){var n=this,i=n.noDisableItemMap,a;if(t){i=_toMap(t)}if(e===undefined?!n.disableMode:e){K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);if(!i[t]){n.disable(e)}});n.disableMode=true}else{K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);if(!i[t]){n.enable(e)}});n.disableMode=false}return n}});function _toolbar(e){return new KToolbar(e)}K.ToolbarClass=KToolbar;K.toolbar=_toolbar;function KMenu(e){this.init(e)}_extend(KMenu,KWidget,{init:function(e){var t=this;e.z=e.z||811213;KMenu.parent.init.call(t,e);t.centerLineMode=_undef(e.centerLineMode,true);t.div.addClass("ke-menu").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on")},addItem:function(t){var e=this;if(t.title==="-"){e.div.append(K('<div class="ke-menu-separator"></div>'));return}var n=K('<div class="ke-menu-item" unselectable="on"></div>'),i=K('<div class="ke-inline-block ke-menu-item-left"></div>'),a=K('<div class="ke-inline-block ke-menu-item-right"></div>'),r=_addUnit(t.height),o=_undef(t.iconClass,"");e.div.append(n);if(r){n.css("height",r);a.css("line-height",r)}var l;if(e.centerLineMode){l=K('<div class="ke-inline-block ke-menu-item-center"></div>');if(r){l.css("height",r)}}n.mouseover(function(e){K(this).addClass("ke-menu-item-on");if(l){l.addClass("ke-menu-item-center-on")}}).mouseout(function(e){K(this).removeClass("ke-menu-item-on");if(l){l.removeClass("ke-menu-item-center-on")}}).click(function(e){t.click.call(K(this));e.stopPropagation()}).append(i);if(l){n.append(l)}n.append(a);if(t.checked){o="ke-icon-checked"}if(o!==""){i.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+o+'"></span>')}a.html(t.title);return e},remove:function(){var e=this;if(e.options.beforeRemove){e.options.beforeRemove.call(e)}K(".ke-menu-item",e.div[0]).unbind();KMenu.parent.remove.call(e);return e}});function _menu(e){return new KMenu(e)}K.MenuClass=KMenu;K.menu=_menu;function KColorPicker(e){this.init(e)}_extend(KColorPicker,KWidget,{init:function(e){var t=this;e.z=e.z||811213;KColorPicker.parent.init.call(t,e);var n=e.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]];t.selectedColor=(e.selectedColor||"").toLowerCase();t._cells=[];t.div.addClass("ke-colorpicker").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on");var i=t.doc.createElement("table");t.div.append(i);i.className="ke-colorpicker-table";i.cellPadding=0;i.cellSpacing=0;i.border=0;var a=i.insertRow(0),r=a.insertCell(0);r.colSpan=n[0].length;t._addAttr(r,"","ke-colorpicker-cell-top");for(var o=0;o<n.length;o++){a=i.insertRow(o+1);for(var l=0;l<n[o].length;l++){r=a.insertCell(l);t._addAttr(r,n[o][l],"ke-colorpicker-cell")}}},_addAttr:function(e,t,n){var i=this;e=K(e).addClass(n);if(i.selectedColor===t.toLowerCase()){e.addClass("ke-colorpicker-cell-selected")}e.attr("title",t||i.options.noColor);e.mouseover(function(e){K(this).addClass("ke-colorpicker-cell-on")});e.mouseout(function(e){K(this).removeClass("ke-colorpicker-cell-on")});e.click(function(e){e.stop();i.options.click.call(K(this),t)});if(t){e.append(K('<div class="ke-colorpicker-cell-color" unselectable="on"></div>').css("background-color",t))}else{e.html(i.options.noColor)}K(e).attr("unselectable","on");i._cells.push(e)},remove:function(){var e=this;_each(e._cells,function(){this.unbind()});KColorPicker.parent.remove.call(e);return e}});function _colorpicker(e){return new KColorPicker(e)}K.ColorPickerClass=KColorPicker;K.colorpicker=_colorpicker;function KUploadButton(e){this.init(e)}_extend(KUploadButton,{init:function(e){var t=this,n=K(e.button),i=e.fieldName||"file",a=e.url||"",r=n.val(),o=e.extraParams||{},l=n[0].className||"",s=e.target||"kindeditor_upload_iframe_"+(new Date).getTime();e.afterError=e.afterError||function(e){alert(e)};var d=[];for(var c in o){d.push('<input type="hidden" name="'+c+'" value="'+o[c]+'" />')}var u=['<div class="ke-inline-block '+l+'">',e.target?"":'<iframe name="'+s+'" style="display:none;"></iframe>',e.form?'<div class="ke-upload-area">':'<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+s+'" action="'+a+'">','<span class="ke-button-common">',d.join(""),'<input type="button" class="ke-button-common ke-button" value="'+r+'" />',"</span>",'<input type="file" class="ke-upload-file" name="'+i+'" tabindex="-1" />',e.form?"</div>":"</form>","</div>"].join("");var f=K(u,n.doc);n.hide();n.before(f);t.div=f;t.button=n;t.iframe=e.target?K('iframe[name="'+s+'"]'):K("iframe",f);t.form=e.form?K(e.form):K("form",f);t.fileBox=K(".ke-upload-file",f);var p=e.width||K(".ke-button-common",f).width();K(".ke-upload-area",f).width(p);t.options=e},submit:function(){var r=this,o=r.iframe;o.bind("load",function(){o.unbind();var e=document.createElement("form");r.fileBox.before(e);K(e).append(r.fileBox);e.reset();K(e).remove(true);var t=K.iframeDoc(o),n=t.getElementsByTagName("pre")[0],i="",a;if(n){i=n.innerHTML}else{i=t.body.innerHTML}i=_unescape(i);o[0].src="javascript:false";try{a=K.json(i)}catch(e){r.options.afterError.call(r,"<!doctype html><html>"+t.body.parentNode.innerHTML+"</html>")}if(a){r.options.afterUpload.call(r,a)}});r.form[0].submit();return r},remove:function(){var e=this;if(e.fileBox){e.fileBox.unbind()}e.iframe.remove();e.div.remove();e.button.show();return e}});function _uploadbutton(e){return new KUploadButton(e)}K.UploadButtonClass=KUploadButton;K.uploadbutton=_uploadbutton;function _createButton(e){e=e||{};var t=e.name||"",n=K('<span class="ke-button-common ke-button-outer" title="'+t+'"></span>'),i=K('<input class="ke-button-common ke-button" type="button" value="'+t+'" />');if(e.click){i.click(e.click)}n.append(i);return n}function KDialog(e){this.init(e)}_extend(KDialog,KWidget,{init:function(e){var t=this;var n=_undef(e.shadowMode,true);e.z=e.z||811213;e.shadowMode=false;e.autoScroll=_undef(e.autoScroll,true);KDialog.parent.init.call(t,e);var i=e.title,a=K(e.body,t.doc),r=e.previewBtn,o=e.yesBtn,l=e.noBtn,s=e.closeBtn,d=_undef(e.showMask,true);t.div.addClass("ke-dialog").bind("click,mousedown",function(e){e.stopPropagation()});var c=K('<div class="ke-dialog-content"></div>').appendTo(t.div);if(_IE&&_V<7){t.iframeMask=K('<iframe src="about:blank" class="ke-dialog-shadow"></iframe>').appendTo(t.div)}else if(n){K('<div class="ke-dialog-shadow"></div>').appendTo(t.div)}var u=K('<div class="ke-dialog-header"></div>');c.append(u);u.html(i);t.closeIcon=K('<span class="ke-dialog-icon-close" title="'+s.name+'"></span>').click(s.click);u.append(t.closeIcon);t.draggable({clickEl:u,beforeDrag:e.beforeDrag});var f=K('<div class="ke-dialog-body"></div>');c.append(f);f.append(a);var p=K('<div class="ke-dialog-footer"></div>');if(r||o||l){c.append(p)}_each([{btn:r,name:"preview"},{btn:o,name:"yes"},{btn:l,name:"no"}],function(){if(this.btn){var e=_createButton(this.btn);e.addClass("ke-dialog-"+this.name);p.append(e)}});if(t.height){f.height(_removeUnit(t.height)-u.height()-p.height())}t.div.width(t.div.width());t.div.height(t.div.height());t.mask=null;if(d){var h=_docElement(t.doc),m=Math.max(h.scrollWidth,h.clientWidth),g=Math.max(h.scrollHeight,h.clientHeight);t.mask=_widget({x:0,y:0,z:t.z-1,cls:"ke-dialog-mask",width:m,height:g})}t.autoPos(t.div.width(),t.div.height());t.footerDiv=p;t.bodyDiv=f;t.headerDiv=u;t.isLoading=false},setMaskIndex:function(e){var t=this;t.mask.div.css("z-index",e)},showLoading:function(e){e=_undef(e,"");var t=this,n=t.bodyDiv;t.loading=K('<div class="ke-dialog-loading"><div class="ke-inline-block ke-dialog-loading-content" style="margin-top:'+Math.round(n.height()/3)+'px;">'+e+"</div></div>").width(n.width()).height(n.height()).css("top",t.headerDiv.height()+"px");n.css("visibility","hidden").after(t.loading);t.isLoading=true;return t},hideLoading:function(){this.loading&&this.loading.remove();this.bodyDiv.css("visibility","visible");this.isLoading=false;return this},remove:function(){var e=this;if(e.options.beforeRemove){e.options.beforeRemove.call(e)}e.mask&&e.mask.remove();e.iframeMask&&e.iframeMask.remove();e.closeIcon.unbind();K("input",e.div).unbind();K("button",e.div).unbind();e.footerDiv.unbind();e.bodyDiv.unbind();e.headerDiv.unbind();K("iframe",e.div).each(function(){K(this).remove()});KDialog.parent.remove.call(e);return e}});function _dialog(e){return new KDialog(e)}K.DialogClass=KDialog;K.dialog=_dialog;function _tabs(e){var i=_widget(e),t=i.remove,a=e.afterSelect,n=i.div,r=[];n.addClass("ke-tabs").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()});var o=K('<ul class="ke-tabs-ul ke-clearfix"></ul>');n.append(o);i.add=function(e){var t=K('<li class="ke-tabs-li">'+e.title+"</li>");t.data("tab",e);r.push(t);o.append(t)};i.selectedIndex=0;i.select=function(n){i.selectedIndex=n;_each(r,function(e,t){t.unbind();if(e===n){t.addClass("ke-tabs-li-selected");K(t.data("tab").panel).show("")}else{t.removeClass("ke-tabs-li-selected").removeClass("ke-tabs-li-on").mouseover(function(){K(this).addClass("ke-tabs-li-on")}).mouseout(function(){K(this).removeClass("ke-tabs-li-on")}).click(function(){i.select(e)});K(t.data("tab").panel).hide()}});if(a){a.call(i,n)}};i.remove=function(){_each(r,function(){this.remove()});o.remove();t.call(i)};return i}K.tabs=_tabs;function _loadScript(e,t){var n=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),i=document.createElement("script");n.appendChild(i);i.src=e;i.charset="utf-8";i.onload=i.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"){if(t){t()}i.onload=i.onreadystatechange=null;n.removeChild(i)}}}function _chopQuery(e){var t=e.indexOf("?");return t>0?e.substr(0,t):e}function _loadStyle(e){var t=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),n=document.createElement("link"),i=_chopQuery(_formatUrl(e,"absolute"));var a=K('link[rel="stylesheet"]',t);for(var r=0,o=a.length;r<o;r++){if(_chopQuery(_formatUrl(a[r].href,"absolute"))===i){return}}t.appendChild(n);n.href=e;n.rel="stylesheet"}function _ajax(e,t,n,i,a){n=n||"GET";a=a||"json";var r=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.open(n,e,true);r.onreadystatechange=function(){if(r.readyState==4&&r.status==200){if(t){var e=_trim(r.responseText);if(a=="json"){e=_json(e)}t(e)}}};if(n=="POST"){var o=[];_each(i,function(e,t){o.push(encodeURIComponent(e)+"="+encodeURIComponent(t))});try{r.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(e){}r.send(o.join("&"))}else{r.send(null)}}K.loadScript=_loadScript;K.loadStyle=_loadStyle;K.ajax=_ajax;var _plugins={};function _plugin(e,t){if(e===undefined){return _plugins}if(!t){return _plugins[e]}_plugins[e]=t}var _language={};function _parseLangKey(e){var t,n="core";if(t=/^(\w+)\.(\w+)$/.exec(e)){n=t[1];e=t[2]}return{ns:n,key:e}}function _lang(e,i){i=i===undefined?K.options.langType:i;if(typeof e==="string"){if(!_language[i]){return"no language"}var t=e.length-1;if(e.substr(t)==="."){return _language[i][e.substr(0,t)]}var n=_parseLangKey(e);return _language[i][n.ns][n.key]}_each(e,function(e,t){var n=_parseLangKey(e);if(!_language[i]){_language[i]={}}if(!_language[i][n.ns]){_language[i][n.ns]={}}_language[i][n.ns][n.key]=t})}function _getImageFromRange(e,t){if(e.collapsed){return}e=e.cloneRange().up();var n=e.startContainer,i=e.startOffset;if(!_WEBKIT&&!e.isControl()){return}var a=K(n.childNodes[i]);if(!a||a.name!="img"){return}if(t(a)){return a}}function _bindContextmenuEvent(){var s=this,e=s.edit.doc;K(e).contextmenu(function(e){if(s.menu){s.hideMenu()}if(!s.useContextmenu){e.preventDefault();return}if(s._contextmenus.length===0){return}var t=0,n=[];_each(s._contextmenus,function(){if(this.title=="-"){n.push(this);return}if(this.cond&&this.cond()){n.push(this);if(this.width&&this.width>t){t=this.width}}});while(n.length>0&&n[0].title=="-"){n.shift()}while(n.length>0&&n[n.length-1].title=="-"){n.pop()}var i=null;_each(n,function(e){if(this.title=="-"&&i.title=="-"){delete n[e]}i=this});if(n.length>0){e.preventDefault();var a=K(s.edit.iframe).pos(),r=_menu({x:a.x+e.clientX,y:a.y+e.clientY,width:t,css:{visibility:"hidden"},shadowMode:s.shadowMode});_each(n,function(){if(this.title){r.addItem(this)}});var o=_docElement(r.doc),l=r.div.height();if(e.clientY+l>=o.clientHeight-100){r.pos(r.x,_removeUnit(r.y)-l)}r.div.css("visibility","visible");s.menu=r}})}function _bindNewlineEvent(){var a=this,r=a.edit.doc,o=a.newlineTag;if(_IE&&o!=="br"){return}if(_GECKO&&_V<3&&o!=="p"){return}if(_OPERA&&_V<9){return}var n=_toMap("h1,h2,h3,h4,h5,h6,pre,li"),l=_toMap("p,h1,h2,h3,h4,h5,h6,pre,li,blockquote");function s(e){var t=K(e.commonAncestor());while(t){if(t.type==1&&!t.isStyle()){break}t=t.parent()}return t.name}K(r).keydown(function(e){if(e.which!=13||e.shiftKey||e.ctrlKey||e.altKey){return}a.cmd.selection();var t=s(a.cmd.range);if(t=="marquee"||t=="select"){return}if(o==="br"&&!n[t]){e.preventDefault();a.insertHtml("<br />"+(_IE&&_V<9?"":"​"));return}if(!l[t]){_nativeCommand(r,"formatblock","<p>")}});K(r).keyup(function(e){if(e.which!=13||e.shiftKey||e.ctrlKey||e.altKey){return}if(o=="br"){return}if(_GECKO){var t=a.cmd.commonAncestor("p");var n=a.cmd.commonAncestor("a");if(n&&n.text()==""){n.remove(true);a.cmd.range.selectNodeContents(t[0]).collapse(true);a.cmd.select()}return}a.cmd.selection();var i=s(a.cmd.range);if(i=="marquee"||i=="select"){return}if(!l[i]){_nativeCommand(r,"formatblock","<p>")}})}function _bindTabEvent(){var i=this,a=i.edit.doc;K(a).keydown(function(e){if(e.which==9){e.preventDefault();if(i.afterTab){i.afterTab.call(i,e);return}var t=i.cmd,n=t.range;n.shrink();if(n.collapsed&&n.startContainer.nodeType==1){n.insertNode(K("@&nbsp;",a)[0]);t.select()}i.insertHtml("&nbsp;&nbsp;&nbsp;&nbsp;")}})}function _bindFocusEvent(){var t=this;K(t.edit.textarea[0],t.edit.win).focus(function(e){if(t.afterFocus){t.afterFocus.call(t,e)}}).blur(function(e){if(t.afterBlur){t.afterBlur.call(t,e)}})}function _removeBookmarkTag(e){return _trim(e.replace(/<span [^>]*id="?__kindeditor_bookmark_\w+_\d+__"?[^>]*><\/span>/gi,""))}function _removeTempTag(e){return e.replace(/<div[^>]+class="?__kindeditor_paste__"?[^>]*>[\s\S]*?<\/div>/gi,"")}function _addBookmarkToStack(e,t){if(e.length===0){e.push(t);return}var n=e[e.length-1];if(_removeBookmarkTag(t.html)!==_removeBookmarkTag(n.html)){e.push(t)}}function _undoToRedo(e,t){var n=this,i=n.edit,a=i.doc.body,r,o;if(e.length===0){return n}if(i.designMode){r=n.cmd.range;o=r.createBookmark(true);o.html=a.innerHTML}else{o={html:a.innerHTML}}_addBookmarkToStack(t,o);var l=e.pop();if(_removeBookmarkTag(o.html)===_removeBookmarkTag(l.html)&&e.length>0){l=e.pop()}if(i.designMode){i.html(l.html);if(l.start){r.moveToBookmark(l);n.select()}}else{K(a).html(_removeBookmarkTag(l.html))}return n}function KEditor(n){var i=this;i.options={};function a(e,t){if(KEditor.prototype[e]===undefined){i[e]=t}i.options[e]=t}_each(n,function(e,t){a(e,n[e])});_each(K.options,function(e,t){if(i[e]===undefined){a(e,t)}});var e=K(i.srcElement||"<textarea/>");if(!i.width){i.width=e[0].style.width||e.width()}if(!i.height){i.height=e[0].style.height||e.height()}a("width",_undef(i.width,i.minWidth));a("height",_undef(i.height,i.minHeight));a("width",_addUnit(i.width));a("height",_addUnit(i.height));if(_MOBILE&&(!_IOS||_V<534)){i.designMode=false}i.srcElement=e;i.initContent="";i.plugin={};i.isCreated=false;i._handlers={};i._contextmenus=[];i._undoStack=[];i._redoStack=[];i._firstAddBookmark=true;i.menu=i.contextmenu=null;i.dialogs=[]}KEditor.prototype={lang:function(e){return _lang(e,this.langType)},loadPlugin:function(e,t){var n=this;var i=this._pluginStatus;if(!i){i=this._pluginStatus={}}if(_plugins[e]){if(!_isFunction(_plugins[e])){setTimeout(function(){n.loadPlugin(e,t)},100);return n}if(!i[e]){_plugins[e].call(n,KindEditor);i[e]="inited"}if(t){t.call(n)}return n}_plugins[e]="loading";_loadScript(n.pluginsPath+e+"/"+e+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){setTimeout(function(){if(_plugins[e]){n.loadPlugin(e,t)}},0)});return n},handler:function(e,t){var n=this;if(!n._handlers[e]){n._handlers[e]=[]}if(_isFunction(t)){n._handlers[e].push(t);return n}_each(n._handlers[e],function(){t=this.call(n,t)});return t},clickToolbar:function(e,t){var n=this,i="clickToolbar"+e;if(t===undefined){if(n._handlers[i]){return n.handler(i)}n.loadPlugin(e,function(){n.handler(i)});return n}return n.handler(i,t)},updateState:function(){var n=this;_each("justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,subscript,superscript,bold,italic,underline,strikethrough".split(","),function(e,t){n.cmd.state(t)?n.toolbar.select(t):n.toolbar.unselect(t)});return n},addContextmenu:function(e){this._contextmenus.push(e);return this},afterCreate:function(e){return this.handler("afterCreate",e)},beforeRemove:function(e){return this.handler("beforeRemove",e)},beforeGetHtml:function(e){return this.handler("beforeGetHtml",e)},beforeSetHtml:function(e){return this.handler("beforeSetHtml",e)},afterSetHtml:function(e){return this.handler("afterSetHtml",e)},create:function(){var o=this,e=o.fullscreenMode;if(o.isCreated){return o}if(o.srcElement.data("kindeditor")){return o}o.srcElement.data("kindeditor","true");if(e){_docElement().style.overflow="hidden"}else{_docElement().style.overflow=""}var t=e?_docElement().clientWidth+"px":o.width,n=e?_docElement().clientHeight+"px":o.height;if(_IE&&_V<8||_QUIRKS){n=_addUnit(_removeUnit(n)+2)}var i=o.container=K(o.layout);if(e){K(document.body).append(i)}else{o.srcElement.before(i)}var a=K(".toolbar",i),r=K(".edit",i),l=o.statusbar=K(".statusbar",i);i.removeClass("container").addClass("ke-container ke-container-"+o.themeType).css("width",t);if(e){i.css({position:"absolute",left:0,top:0,"z-index":811211});if(!_GECKO){o._scrollPos=_getScrollPos()}window.scrollTo(0,0);K(document.body).css({height:"1px",overflow:"hidden"});K(document.body.parentNode).css("overflow","hidden");o._fullscreenExecuted=true}else{if(o._fullscreenExecuted){K(document.body).css({height:"",overflow:""});K(document.body.parentNode).css("overflow","")}if(o._scrollPos){window.scrollTo(o._scrollPos.x,o._scrollPos.y)}}var s=[];K.each(o.items,function(e,t){if(t=="|"){s.push('<span class="ke-inline-block ke-separator"></span>')}else if(t=="/"){s.push('<div class="ke-hr"></div>')}else{s.push('<span class="ke-outline" data-name="'+t+'" title="'+o.lang(t)+'" unselectable="on">');s.push('<span class="ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+t+'" unselectable="on"></span></span>')}});var d=o.toolbar=_toolbar({src:a,html:s.join(""),noDisableItems:o.noDisableItems,click:function(e,t){e.stop();if(o.menu){var n=o.menu.name;o.hideMenu();if(n===t){return}}o.clickToolbar(t)}});var c=_removeUnit(n)-d.div.height();var u=o.edit=_edit({height:c>0&&_removeUnit(n)>o.minHeight?c:o.minHeight,src:r,srcElement:o.srcElement,designMode:o.designMode,themesPath:o.themesPath,bodyClass:o.bodyClass,cssPath:o.cssPath,cssData:o.cssData,beforeGetHtml:function(e){e=o.beforeGetHtml(e);e=_removeBookmarkTag(_removeTempTag(e));return _formatHtml(e,o.filterMode?o.htmlTags:null,o.urlType,o.wellFormatMode,o.indentChar)},beforeSetHtml:function(e){e=_formatHtml(e,o.filterMode?o.htmlTags:null,"",false);return o.beforeSetHtml(e)},afterSetHtml:function(){o.edit=u=this;o.afterSetHtml()},afterCreate:function(){o.edit=u=this;o.cmd=u.cmd;o._docMousedownFn=function(e){if(o.menu){o.hideMenu()}};K(u.doc,document).mousedown(o._docMousedownFn);_bindContextmenuEvent.call(o);_bindNewlineEvent.call(o);_bindTabEvent.call(o);_bindFocusEvent.call(o);u.afterChange(function(e){if(!u.designMode){return}o.updateState();o.addBookmark();if(o.options.afterChange){o.options.afterChange.call(o)}});u.textarea.keyup(function(e){if(!e.ctrlKey&&!e.altKey&&_INPUT_KEY_MAP[e.which]){if(o.options.afterChange){o.options.afterChange.call(o)}}});if(o.readonlyMode){o.readonly()}o.isCreated=true;if(o.initContent===""){o.initContent=o.html()}if(o._undoStack.length>0){var e=o._undoStack.pop();if(e.start){o.html(e.html);u.cmd.range.moveToBookmark(e);o.select()}}o.afterCreate();if(o.options.afterCreate){o.options.afterCreate.call(o)}}});l.removeClass("statusbar").addClass("ke-statusbar").append('<span class="ke-inline-block ke-statusbar-center-icon"></span>').append('<span class="ke-inline-block ke-statusbar-right-icon"></span>');if(o._fullscreenResizeHandler){K(window).unbind("resize",o._fullscreenResizeHandler);o._fullscreenResizeHandler=null}function f(){if(l.height()===0){setTimeout(f,100);return}o.resize(t,n,false)}f();if(e){o._fullscreenResizeHandler=function(e){if(o.isCreated){o.resize(_docElement().clientWidth,_docElement().clientHeight,false)}};K(window).bind("resize",o._fullscreenResizeHandler);d.select("fullscreen");l.first().css("visibility","hidden");l.last().css("visibility","hidden")}else{if(_GECKO){K(window).bind("scroll",function(e){o._scrollPos=_getScrollPos()})}if(o.resizeType>0){_drag({moveEl:i,clickEl:l,moveFn:function(e,t,n,i,a,r){i+=r;o.resize(null,i)}})}else{l.first().css("visibility","hidden")}if(o.resizeType===2){_drag({moveEl:i,clickEl:l.last(),moveFn:function(e,t,n,i,a,r){n+=a;i+=r;o.resize(n,i)}})}else{l.last().css("visibility","hidden")}}return o},remove:function(){var e=this;if(!e.isCreated){return e}e.beforeRemove();e.srcElement.data("kindeditor","");if(e.menu){e.hideMenu()}_each(e.dialogs,function(){e.hideDialog()});K(document).unbind("mousedown",e._docMousedownFn);e.toolbar.remove();e.edit.remove();e.statusbar.last().unbind();e.statusbar.unbind();e.container.remove();e.container=e.toolbar=e.edit=e.menu=null;e.dialogs=[];e.isCreated=false;return e},resize:function(e,t,n){var i=this;n=_undef(n,true);if(e){if(!/%/.test(e)){e=_removeUnit(e);e=e<i.minWidth?i.minWidth:e}i.container.css("width",_addUnit(e));if(n){i.width=_addUnit(e)}}if(t){t=_removeUnit(t);var a=_removeUnit(t)-i.toolbar.div.height()-i.statusbar.height();a=a<i.minHeight?i.minHeight:a;i.edit.setHeight(a);if(n){i.height=_addUnit(t)}}return i},select:function(){this.isCreated&&this.cmd.select();return this},html:function(e){var t=this;if(e===undefined){return t.isCreated?t.edit.html():_elementVal(t.srcElement)}t.isCreated?t.edit.html(e):_elementVal(t.srcElement,e);if(t.isCreated){t.cmd.selection()}return t},fullHtml:function(){return this.isCreated?this.edit.html(undefined,true):""},text:function(e){var t=this;if(e===undefined){return _trim(t.html().replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," "))}else{return t.html(_escape(e))}},isEmpty:function(){return _trim(this.text().replace(/\r\n|\n|\r/,""))===""},isDirty:function(){return _trim(this.initContent.replace(/\r\n|\n|\r|t/g,""))!==_trim(this.html().replace(/\r\n|\n|\r|t/g,""))},selectedHtml:function(){var e=this.isCreated?this.cmd.range.html():"";e=_removeBookmarkTag(_removeTempTag(e));return e},count:function(e){var t=this;e=(e||"html").toLowerCase();if(e==="html"){return t.html().length}if(e==="text"){return t.text().replace(/<(?:img|embed).*?>/gi,"K").replace(/\r\n|\n|\r/g,"").length}return 0},exec:function(e){e=e.toLowerCase();var t=this,n=t.cmd,i=_inArray(e,"selectall,copy,paste,print".split(","))<0;if(i){t.addBookmark(false)}n[e].apply(n,_toArray(arguments,1));if(i){t.updateState();t.addBookmark(false);if(t.options.afterChange){t.options.afterChange.call(t)}}return t},insertHtml:function(e,t){if(!this.isCreated){return this}e=this.beforeSetHtml(e);this.exec("inserthtml",e,t);return this},appendHtml:function(e){this.html(this.html()+e);if(this.isCreated){var t=this.cmd;t.range.selectNodeContents(t.doc.body).collapse(false);t.select()}return this},sync:function(){_elementVal(this.srcElement,this.html());return this},focus:function(){this.isCreated?this.edit.focus():this.srcElement[0].focus();return this},blur:function(){this.isCreated?this.edit.blur():this.srcElement[0].blur();return this},addBookmark:function(e){e=_undef(e,true);var t=this,n=t.edit,i=n.doc.body,a=_removeTempTag(i.innerHTML),r;if(e&&t._undoStack.length>0){var o=t._undoStack[t._undoStack.length-1];if(Math.abs(a.length-_removeBookmarkTag(o.html).length)<t.minChangeSize){return t}}if(n.designMode&&!t._firstAddBookmark){var l=t.cmd.range;r=l.createBookmark(true);r.html=_removeTempTag(i.innerHTML);l.moveToBookmark(r)}else{r={html:a}}t._firstAddBookmark=false;_addBookmarkToStack(t._undoStack,r);return t},undo:function(){return _undoToRedo.call(this,this._undoStack,this._redoStack)},redo:function(){return _undoToRedo.call(this,this._redoStack,this._undoStack)},fullscreen:function(e){this.fullscreenMode=e===undefined?!this.fullscreenMode:e;this.addBookmark(false);return this.remove().create()},readonly:function(e){e=_undef(e,true);var t=this,n=t.edit,i=n.doc;if(t.designMode){t.toolbar.disableAll(e,[])}else{_each(t.noDisableItems,function(){t.toolbar[e?"disable":"enable"](this)})}if(_IE){i.body.contentEditable=!e}else{i.designMode=e?"off":"on"}n.textarea[0].disabled=e},createMenu:function(e){var t=this,n=e.name,i=t.toolbar.get(n),a=i.pos();e.x=a.x;e.y=a.y+i.height();e.z=t.options.zIndex;e.shadowMode=_undef(e.shadowMode,t.shadowMode);if(e.selectedColor!==undefined){e.cls="ke-colorpicker-"+t.themeType;e.noColor=t.lang("noColor");t.menu=_colorpicker(e)}else{e.cls="ke-menu-"+t.themeType;e.centerLineMode=false;t.menu=_menu(e)}return t.menu},hideMenu:function(){this.menu.remove();this.menu=null;return this},hideContextmenu:function(){this.contextmenu.remove();this.contextmenu=null;return this},createDialog:function(e){var t=this,n=e.name;e.z=t.options.zIndex;e.shadowMode=_undef(e.shadowMode,t.shadowMode);e.closeBtn=_undef(e.closeBtn,{name:t.lang("close"),click:function(e){t.hideDialog();if(_IE&&t.cmd){t.cmd.select()}}});e.noBtn=_undef(e.noBtn,{name:t.lang(e.yesBtn?"no":"close"),click:function(e){t.hideDialog();if(_IE&&t.cmd){t.cmd.select()}}});if(t.dialogAlignType!="page"){e.alignEl=t.container}e.cls="ke-dialog-"+t.themeType;if(t.dialogs.length>0){var i=t.dialogs[0],a=t.dialogs[t.dialogs.length-1];i.setMaskIndex(a.z+2);e.z=a.z+3;e.showMask=false}var r=_dialog(e);t.dialogs.push(r);return r},hideDialog:function(){var e=this;if(e.dialogs.length>0){e.dialogs.pop().remove()}if(e.dialogs.length>0){var t=e.dialogs[0],n=e.dialogs[e.dialogs.length-1];t.setMaskIndex(n.z-1)}return e},errorDialog:function(e){var t=this;var n=t.createDialog({width:750,title:t.lang("uploadError"),body:'<div style="padding:10px 20px;"><iframe frameborder="0" style="width:708px;height:400px;"></iframe></div>'});var i=K("iframe",n.div),a=K.iframeDoc(i);a.open();a.write(e);a.close();K(a.body).css("background-color","#FFF");i[0].contentWindow.focus();return t}};function _editor(e){return new KEditor(e)}var _instances=[];function _create(e,t){t=t||{};t.basePath=_undef(t.basePath,K.basePath);t.themesPath=_undef(t.themesPath,t.basePath+"themes/");t.langPath=_undef(t.langPath,t.basePath+"lang/");t.pluginsPath=_undef(t.pluginsPath,t.basePath+"plugins/");if(_undef(t.loadStyleMode,K.options.loadStyleMode)){var n=_undef(t.themeType,K.options.themeType);_loadStyle(t.themesPath+"default/default.css");_loadStyle(t.themesPath+n+"/"+n+".css")}function i(n){_each(_plugins,function(e,t){if(_isFunction(t)){t.call(n,KindEditor);if(!n._pluginStatus){n._pluginStatus={}}n._pluginStatus[e]="inited"}});return n.create()}var a=K(e);if(!a||a.length===0){return}if(a.length>1){a.each(function(){_create(this,t)});return _instances[0]}t.srcElement=a[0];var r=new KEditor(t);_instances.push(r);if(_language[r.langType]){return i(r)}_loadScript(r.langPath+r.langType+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){i(r)});return r}function _eachEditor(e,i){console.log(e);K(e).each(function(e,n){K.each(_instances,function(e,t){if(t&&t.srcElement[0]==n){i.call(t,e);return false}})})}K.remove=function(e){_eachEditor(e,function(e){this.remove();_instances.splice(e,1)})};K.sync=function(e){_eachEditor(e,function(){this.sync()})};K.html=function(e,t){_eachEditor(e,function(){this.html(t)})};K.insertHtml=function(e,t){_eachEditor(e,function(){this.insertHtml(t)})};K.appendHtml=function(e,t){_eachEditor(e,function(){this.appendHtml(t)})};if(_IE&&_V<7){_nativeCommand(document,"BackgroundImageCache",true)}K.EditorClass=KEditor;K.editor=_editor;K.create=_create;K.instances=_instances;K.plugin=_plugin;K.lang=_lang;_plugin("core",function(d){var c=this,n={undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",print:"P",selectall:"A"};c.afterSetHtml(function(){if(c.options.afterChange){c.options.afterChange.call(c)}});c.afterCreate(function(){if(c.syncType!="form"){return}var e=d(c.srcElement),t=false;while(e=e.parent()){if(e.name=="form"){t=true;break}}if(t){e.bind("submit",function(e){c.sync();d(window).bind("unload",function(){c.edit.textarea.remove()})});var n=d('[type="reset"]',e);n.click(function(){c.html(c.initContent);c.cmd.selection()});c.beforeRemove(function(){e.unbind();n.unbind()})}});c.clickToolbar("source",function(){if(c.edit.designMode){c.toolbar.disableAll(true);c.edit.design(false);c.toolbar.select("source")}else{c.toolbar.disableAll(false);c.edit.design(true);c.toolbar.unselect("source");if(_GECKO){setTimeout(function(){c.cmd.selection()},0)}else{c.cmd.selection()}}c.designMode=c.edit.designMode});c.afterCreate(function(){if(!c.designMode){c.toolbar.disableAll(true).select("source")}});c.clickToolbar("fullscreen",function(){c.fullscreen()});if(c.fullscreenShortcut){var e=false;c.afterCreate(function(){d(c.edit.doc,c.edit.textarea).keyup(function(e){if(e.which==27){setTimeout(function(){c.fullscreen()},0)}});if(e){if(_IE&&!c.designMode){return}c.focus()}if(!e){e=true}})}_each("undo,redo".split(","),function(e,t){if(n[t]){c.afterCreate(function(){_ctrl(this.edit.doc,n[t],function(){c.clickToolbar(t)})})}c.clickToolbar(t,function(){c[t]()})});c.clickToolbar("formatblock",function(){var e=c.lang("formatblock.formatBlock"),i={h1:28,h2:24,h3:18,H4:14,p:12},a=c.cmd.val("formatblock"),r=c.createMenu({name:"formatblock",width:c.langType=="en"?200:150});_each(e,function(e,t){var n="font-size:"+i[e]+"px;";if(e.charAt(0)==="h"){n+="font-weight:bold;"}r.addItem({title:'<span style="'+n+'" unselectable="on">'+t+"</span>",height:i[e]+12,checked:a===e||a===t,click:function(){c.select().exec("formatblock","<"+e+">").hideMenu()}})})});c.clickToolbar("fontname",function(){var n=c.cmd.val("fontname"),i=c.createMenu({name:"fontname",width:150});_each(c.lang("fontname.fontName"),function(e,t){i.addItem({title:'<span style="font-family: '+e+';" unselectable="on">'+t+"</span>",checked:n===e.toLowerCase()||n===t.toLowerCase(),click:function(){c.exec("fontname",e).hideMenu()}})})});c.clickToolbar("fontsize",function(){var n=c.cmd.val("fontsize"),i=c.createMenu({name:"fontsize",width:150});_each(c.fontSizeTable,function(e,t){i.addItem({title:'<span style="font-size:'+t+';" unselectable="on">'+t+"</span>",height:_removeUnit(t)+12,checked:n===t,click:function(){c.exec("fontsize",t).hideMenu()}})})});_each("forecolor,hilitecolor".split(","),function(e,t){c.clickToolbar(t,function(){c.createMenu({name:t,selectedColor:c.cmd.val(t)||"default",colors:c.colorTable,click:function(e){c.exec(t,e).hideMenu()}})})});_each("cut,copy,paste".split(","),function(e,t){c.clickToolbar(t,function(){c.focus();try{c.exec(t,null)}catch(e){alert(c.lang(t+"Error"))}})});c.clickToolbar("about",function(){var e='<div style="margin:20px;"><div>KindEditor LayUi</div><div>Copyright &copy; <a href="https://www.ziyuan.shop/" target="_blank">ziyuan.shop</a> All rights reserved.</div></div>';c.createDialog({name:"about",width:350,title:c.lang("about"),body:e})});c.plugin.getSelectedLink=function(){return c.cmd.commonAncestor("a")};c.plugin.getSelectedImage=function(){return _getImageFromRange(c.edit.cmd.range,function(e){return!/^ke-\w+$/i.test(e[0].className)})};c.plugin.getSelectedFlash=function(){return _getImageFromRange(c.edit.cmd.range,function(e){return e[0].className=="ke-flash"})};c.plugin.getSelectedMedia=function(){return _getImageFromRange(c.edit.cmd.range,function(e){return e[0].className=="ke-media"||e[0].className=="ke-rm"})};c.plugin.getSelectedAnchor=function(){return _getImageFromRange(c.edit.cmd.range,function(e){return e[0].className=="ke-anchor"})};_each("link,image,flash,media,anchor".split(","),function(e,n){var i=n.charAt(0).toUpperCase()+n.substr(1);_each("edit,delete".split(","),function(e,t){c.addContextmenu({title:c.lang(t+i),click:function(){c.loadPlugin(n,function(){c.plugin[n][t]();c.hideMenu()})},cond:c.plugin["getSelected"+i],width:150,iconClass:t=="edit"?"ke-icon-"+n:undefined})});c.addContextmenu({title:"-"})});c.plugin.getSelectedTable=function(){return c.cmd.commonAncestor("table")};c.plugin.getSelectedRow=function(){return c.cmd.commonAncestor("tr")};c.plugin.getSelectedCell=function(){return c.cmd.commonAncestor("td")};_each("prop,cellprop,colinsertleft,colinsertright,rowinsertabove,rowinsertbelow,rowmerge,colmerge,rowsplit,colsplit,coldelete,rowdelete,insert,delete".split(","),function(e,t){var n=_inArray(t,["prop","delete"])<0?c.plugin.getSelectedCell:c.plugin.getSelectedTable;c.addContextmenu({title:c.lang("table"+t),click:function(){c.loadPlugin("table",function(){c.plugin.table[t]();c.hideMenu()})},cond:n,width:170,iconClass:"ke-icon-table"+t})});c.addContextmenu({title:"-"});_each("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript,hr,print,bold,italic,underline,strikethrough,removeformat,unlink".split(","),function(e,t){if(n[t]){c.afterCreate(function(){_ctrl(this.edit.doc,n[t],function(){c.cmd.selection();c.clickToolbar(t)})})}c.clickToolbar(t,function(){c.focus().exec(t,null)})});c.afterCreate(function(){var n=c.edit.doc,i,a,r,o="__kindeditor_paste__",l=false;function s(){i.range.moveToBookmark(a);i.select();if(_WEBKIT){d("div."+o,r).each(function(){d(this).after("<br />").remove(true)});d("span.Apple-style-span",r).remove(true);d("span.Apple-tab-span",r).remove(true);d("span[style]",r).each(function(){if(d(this).css("white-space")=="nowrap"){d(this).remove(true)}});d("meta",r).remove()}var e=r[0].innerHTML;r.remove();if(e===""){return}if(_WEBKIT){e=e.replace(/(<br>)\1/gi,"$1")}if(c.pasteType===2){e=e.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"");if(/schemas-microsoft-com|worddocument|mso-\w+/i.test(e)){e=_clearMsWord(e,c.filterMode?c.htmlTags:d.options.htmlTags)}else{e=_formatHtml(e,c.filterMode?c.htmlTags:null);e=c.beforeSetHtml(e)}}if(c.pasteType===1){e=e.replace(/&nbsp;/gi," ");e=e.replace(/\n\s*\n/g,"\n");e=e.replace(/<br[^>]*>/gi,"\n");e=e.replace(/<\/p><p[^>]*>/gi,"\n");e=e.replace(/<[^>]+>/g,"");e=e.replace(/ {2}/g," &nbsp;");if(c.newlineTag=="p"){if(/\n/.test(e)){e=e.replace(/^/,"<p>").replace(/$/,"<br /></p>").replace(/\n/g,"<br /></p><p>")}}else{e=e.replace(/\n/g,"<br />$&")}}c.insertHtml(e,true)}d(n.body).bind("paste",function(e){if(c.pasteType===0){e.stop();return}if(l){return}l=true;d("div."+o,n).remove();i=c.cmd.selection();a=i.range.createBookmark();r=d('<div class="'+o+'"></div>',n).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:"-1981px",top:d(a.start).pos().y+"px","white-space":"nowrap"});d(n.body).append(r);if(_IE){var t=i.range.get(true);t.moveToElementText(r[0]);t.select();t.execCommand("paste");e.preventDefault()}else{i.range.selectNodeContents(r[0]);i.select();r[0].tabIndex=-1;r[0].focus()}setTimeout(function(){s();l=false},0)})});c.beforeGetHtml(function(e){if(_IE&&_V<=8){e=e.replace(/<div\s+[^>]*data-ke-input-tag="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t){return unescape(t)});e=e.replace(/(<input)((?:\s+[^>]*)?>)/gi,function(e,t,n){if(!/\s+type="[^"]+"/i.test(e)){return t+' type="text"'+n}return e})}return e.replace(/(<(?:noscript|noscript\s[^>]*)>)([\s\S]*?)(<\/noscript>)/gi,function(e,t,n,i){return t+_unescape(n).replace(/\s+/g," ")+i}).replace(/<img[^>]*class="?ke-(flash|rm|media)"?[^>]*>/gi,function(e){var t=_getAttrList(e);var n=_getCssList(t.style||"");var i=_mediaAttrs(t["data-ke-tag"]);var a=_undef(n.width,"");var r=_undef(n.height,"");if(/px/i.test(a)){a=_removeUnit(a)}if(/px/i.test(r)){r=_removeUnit(r)}i.width=_undef(t.width,a);i.height=_undef(t.height,r);return _mediaEmbed(i)}).replace(/<img[^>]*class="?ke-anchor"?[^>]*>/gi,function(e){var t=_getAttrList(e);return'<a name="'+unescape(t["data-ke-name"])+'"></a>'}).replace(/<div\s+[^>]*data-ke-script-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t,n){return"<script"+unescape(t)+">"+unescape(n)+"<\/script>"}).replace(/<div\s+[^>]*data-ke-noscript-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t,n){return"<noscript"+unescape(t)+">"+unescape(n)+"</noscript>"}).replace(/(<[^>]*)data-ke-src="([^"]*)"([^>]*>)/gi,function(e,t,i,n){e=e.replace(/(\s+(?:href|src)=")[^"]*(")/i,function(e,t,n){return t+_unescape(i)+n});e=e.replace(/\s+data-ke-src="[^"]*"/i,"");return e}).replace(/(<[^>]+\s)data-ke-(on\w+="[^"]*"[^>]*>)/gi,function(e,t,n){return t+n})});c.beforeSetHtml(function(e){if(_IE&&_V<=8){e=e.replace(/<input[^>]*>|<(select|button)[^>]*>[\s\S]*?<\/\1>/gi,function(e){var t=_getAttrList(e);var n=_getCssList(t.style||"");if(n.display=="none"){return'<div class="ke-display-none" data-ke-input-tag="'+escape(e)+'"></div>'}return e})}return e.replace(/<embed[^>]*type="([^"]+)"[^>]*>(?:<\/embed>)?/gi,function(e){var t=_getAttrList(e);t.src=_undef(t.src,"");t.width=_undef(t.width,0);t.height=_undef(t.height,0);return _mediaImg(c.themesPath+"common/blank.gif",t)}).replace(/<a[^>]*name="([^"]+)"[^>]*>(?:<\/a>)?/gi,function(e){var t=_getAttrList(e);if(t.href!==undefined){return e}return'<img class="ke-anchor" src="'+c.themesPath+'common/anchor.gif" data-ke-name="'+escape(t.name)+'" />'}).replace(/<script([^>]*)>([\s\S]*?)<\/script>/gi,function(e,t,n){return'<div class="ke-script" data-ke-script-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/<noscript([^>]*)>([\s\S]*?)<\/noscript>/gi,function(e,t,n){return'<div class="ke-noscript" data-ke-noscript-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/(<[^>]*)(href|src)="([^"]*)"([^>]*>)/gi,function(e,t,n,i,a){if(e.match(/\sdata-ke-src="[^"]*"/i)){return e}e=t+n+'="'+i+'" data-ke-src="'+_escape(i)+'"'+a;return e}).replace(/(<[^>]+\s)(on\w+="[^"]*"[^>]*>)/gi,function(e,t,n){return t+"data-ke-"+n}).replace(/<table[^>]*\s+border="0"[^>]*>/gi,function(e){if(e.indexOf("ke-zeroborder")>=0){return e}return _addClassToTag(e,"ke-zeroborder")})})})})(window);KindEditor.lang({source:"HTML代码",preview:"预览",undo:"后退(Ctrl+Z)",redo:"前进(Ctrl+Y)",cut:"剪切(Ctrl+X)",copy:"复制(Ctrl+C)",paste:"粘贴(Ctrl+V)",plainpaste:"粘贴为无格式文本",wordpaste:"从Word粘贴",selectall:"全选(Ctrl+A)",justifyleft:"左对齐",justifycenter:"居中",justifyright:"右对齐",justifyfull:"两端对齐",insertorderedlist:"编号",insertunorderedlist:"项目符号",indent:"增加缩进",outdent:"减少缩进",subscript:"下标",superscript:"上标",formatblock:"段落",fontname:"字体",fontsize:"文字大小",forecolor:"文字颜色",hilitecolor:"文字背景",bold:"粗体(Ctrl+B)",italic:"斜体(Ctrl+I)",underline:"下划线(Ctrl+U)",strikethrough:"删除线",removeformat:"删除格式",image:"图片",multiimage:"批量图片上传",flash:"Flash",media:"视音频",table:"表格",tablecell:"单元格",hr:"插入横线",emoticons:"插入表情",link:"超级链接",unlink:"取消超级链接",fullscreen:"全屏显示",about:"关于",print:"打印(Ctrl+P)",filemanager:"文件空间",code:"插入程序代码",map:"Google地图",baidumap:"百度地图",lineheight:"行距",clearhtml:"清理HTML代码",pagebreak:"插入分页符",quickformat:"一键排版",insertfile:"插入文件",template:"插入模板",anchor:"锚点",yes:"确定",no:"取消",close:"关闭",editImage:"图片属性",deleteImage:"删除图片",editFlash:"Flash属性",deleteFlash:"删除Flash",editMedia:"视音频属性",deleteMedia:"删除视音频",editLink:"超级链接属性",deleteLink:"取消超级链接",editAnchor:"锚点属性",deleteAnchor:"删除锚点",tableprop:"表格属性",tablecellprop:"单元格属性",tableinsert:"插入表格",tabledelete:"删除表格",tablecolinsertleft:"左侧插入列",tablecolinsertright:"右侧插入列",tablerowinsertabove:"上方插入行",tablerowinsertbelow:"下方插入行",tablerowmerge:"向下合并单元格",tablecolmerge:"向右合并单元格",tablerowsplit:"拆分行",tablecolsplit:"拆分列",tablecoldelete:"删除列",tablerowdelete:"删除行",noColor:"无颜色",pleaseSelectFile:"请选择文件。",invalidImg:"请输入有效的URL地址。\n只允许jpg,gif,bmp,png格式。",invalidMedia:"请输入有效的URL地址。\n只允许swf,flv,mp3,wav,wma,wmv,mid,avi,mpg,asf,rm,rmvb格式。",invalidWidth:"宽度必须为数字。",invalidHeight:"高度必须为数字。",invalidBorder:"边框必须为数字。",invalidUrl:"请输入有效的URL地址。",invalidRows:"行数为必选项，只允许输入大于0的数字。",invalidCols:"列数为必选项，只允许输入大于0的数字。",invalidPadding:"边距必须为数字。",invalidSpacing:"间距必须为数字。",invalidJson:"服务器发生故障。",uploadSuccess:"上传成功。",cutError:"您的浏览器安全设置不允许使用剪切操作，请使用快捷键(Ctrl+X)来完成。",copyError:"您的浏览器安全设置不允许使用复制操作，请使用快捷键(Ctrl+C)来完成。",pasteError:"您的浏览器安全设置不允许使用粘贴操作，请使用快捷键(Ctrl+V)来完成。",ajaxLoading:"加载中，请稍候 ...",uploadLoading:"上传中，请稍候 ...",uploadError:"上传错误","plainpaste.comment":"请使用快捷键(Ctrl+V)把内容粘贴到下面的方框里。","wordpaste.comment":"请使用快捷键(Ctrl+V)把内容粘贴到下面的方框里。","code.pleaseInput":"请输入程序代码。","link.url":"URL","link.linkType":"打开类型","link.newWindow":"新窗口","link.selfWindow":"当前窗口","flash.url":"URL","flash.width":"宽度","flash.height":"高度","flash.upload":"上传","flash.viewServer":"文件空间","media.url":"URL","media.width":"宽度","media.height":"高度","media.autostart":"自动播放","media.upload":"上传","media.viewServer":"文件空间","image.remoteImage":"网络图片","image.localImage":"本地上传","image.remoteUrl":"图片地址","image.localUrl":"上传文件","image.size":"图片大小","image.width":"宽","image.height":"高","image.resetSize":"重置大小","image.align":"对齐方式","image.defaultAlign":"默认方式","image.leftAlign":"左对齐","image.rightAlign":"右对齐","image.imgTitle":"图片说明","image.upload":"浏览...","image.viewServer":"图片空间","multiimage.uploadDesc":"允许用户同时上传<%=uploadLimit%>张图片，单张图片容量不超过<%=sizeLimit%>","multiimage.startUpload":"开始上传","multiimage.clearAll":"全部清空","multiimage.insertAll":"全部插入","multiimage.queueLimitExceeded":"文件数量超过限制。","multiimage.fileExceedsSizeLimit":"文件大小超过限制。","multiimage.zeroByteFile":"无法上传空文件。","multiimage.invalidFiletype":"文件类型不正确。","multiimage.unknownError":"发生异常，无法上传。","multiimage.pending":"等待上传","multiimage.uploadError":"上传失败","filemanager.emptyFolder":"空文件夹","filemanager.moveup":"移到上一级文件夹","filemanager.viewType":"显示方式：","filemanager.viewImage":"缩略图","filemanager.listImage":"详细信息","filemanager.orderType":"排序方式：","filemanager.fileName":"名称","filemanager.fileSize":"大小","filemanager.fileType":"类型","insertfile.url":"URL","insertfile.title":"文件说明","insertfile.upload":"上传","insertfile.viewServer":"文件空间","table.cells":"单元格数","table.rows":"行数","table.cols":"列数","table.size":"大小","table.width":"宽度","table.height":"高度","table.percent":"%","table.px":"px","table.space":"边距间距","table.padding":"边距","table.spacing":"间距","table.align":"对齐方式","table.textAlign":"水平对齐","table.verticalAlign":"垂直对齐","table.alignDefault":"默认","table.alignLeft":"左对齐","table.alignCenter":"居中","table.alignRight":"右对齐","table.alignTop":"顶部","table.alignMiddle":"中部","table.alignBottom":"底部","table.alignBaseline":"基线","table.border":"边框","table.borderWidth":"边框","table.borderColor":"颜色","table.backgroundColor":"背景颜色","map.address":"地址: ","map.search":"搜索","baidumap.address":"地址: ","baidumap.search":"搜索","baidumap.insertDynamicMap":"插入动态地图","anchor.name":"锚点名称","formatblock.formatBlock":{h1:"标题 1",h2:"标题 2",h3:"标题 3",h4:"标题 4",p:"正 文"},"fontname.fontName":{SimSun:"宋体",NSimSun:"新宋体",FangSong_GB2312:"仿宋_GB2312",KaiTi_GB2312:"楷体_GB2312",SimHei:"黑体","Microsoft YaHei":"微软雅黑",Arial:"Arial","Arial Black":"Arial Black","Times New Roman":"Times New Roman","Courier New":"Courier New",Tahoma:"Tahoma",Verdana:"Verdana"},"lineheight.lineHeight":[{1:"单倍行距"},{1.5:"1.5倍行距"},{2:"2倍行距"},{2.5:"2.5倍行距"},{3:"3倍行距"}],"template.selectTemplate":"可选模板","template.replaceContent":"替换当前内容","template.fileList":{"1.html":"图片和文字","2.html":"表格","3.html":"项目编号"}},"zh-CN");KindEditor.options.langType="zh-CN";KindEditor.plugin("anchor",function(r){var o=this,l="anchor",s=o.lang(l+".");o.plugin.anchor={edit:function(){var e=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keName">'+s.name+"</label>",'<input class="ke-input-text" type="text" id="keName" name="name" value="" style="width:100px;" />',"</div>","</div>"].join("");var t=o.createDialog({name:l,width:300,title:o.lang(l),body:e,yesBtn:{name:o.lang("yes"),click:function(e){o.insertHtml('<a name="'+i.val()+'">').hideDialog().focus()}}});var n=t.div,i=r('input[name="name"]',n);var a=o.plugin.getSelectedAnchor();if(a){i.val(unescape(a.attr("data-ke-name")))}i[0].focus();i[0].select()},delete:function(){o.plugin.getSelectedAnchor().remove()}};o.clickToolbar(l,o.plugin.anchor.edit)});KindEditor.plugin("autoheight",function(n){var i=this;if(!i.autoHeightMode){return}var a;function e(){var e=i.edit;var t=e.doc.body;e.iframe[0].scroll="no";t.style.overflowY="hidden"}function t(){if(i.fullscreenMode){return}var e=i.edit;var t=e.doc.body;e.iframe.height(a);i.resize(null,Math.max((n.IE?t.scrollHeight:t.offsetHeight)+76,a))}function r(){a=n.removeUnit(i.height);i.edit.afterChange(t);if(!i.fullscreenMode){e()}t()}if(i.isCreated){r()}else{i.afterCreate(r)}});KindEditor.plugin("multiimage",function(e){var n=this;setTimeout(function(e,t){layui.upload.render({elem:$("#"+TTTXUANCLASS+"idx_"+e).find('[data-name="multiimage"]'),field:"all",multiple:true,url:uploadurl(""),auto:!BASEUP,choose:function(i){if(BASEUP){i.preview(function(e,t,n){t=new File([n],t.name);i.upload(e,t)})}},done:function(e){if(e.code==1){if(typeof pichttp=="function"){n.exec("insertimage",pichttp(e.data)).focus()}else{n.exec("insertimage",e.data).focus()}}else{}}})},800,n.options.ttttt)});KindEditor.plugin("baidumap",function(c){var u=this,f="baidumap",p=u.lang(f+".");var h=c.undef(u.mapWidth,558);var m=c.undef(u.mapHeight,360);u.clickToolbar(f,function(){var e=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',p.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+p.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+p.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+h+"px;height:"+m+'px;"></div>',"</div>"].join("");var t=u.createDialog({name:f,width:h+42,title:u.lang(f),body:e,yesBtn:{name:u.lang("yes"),click:function(e){var t=l.map;var n=t.getCenter();var i=n.lng+","+n.lat;var a=t.getZoom();var r=[o[0].checked?u.pluginsPath+"baidumap/index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(i),"&zoom="+encodeURIComponent(a),"&width="+h,"&height="+m,"&markers="+encodeURIComponent(i),"&markerStyles="+encodeURIComponent("l,A")].join("");if(o[0].checked){u.insertHtml('<iframe src="'+r+'" frameborder="0" style="width:'+(h+2)+"px;height:"+(m+2)+'px;"></iframe>')}else{u.exec("insertimage",r)}u.hideDialog().focus()}},beforeRemove:function(){a.remove();if(r){r.write("")}s.remove()}});var n=t.div,i=c('[name="address"]',n),a=c('[name="searchBtn"]',n),o=c('[name="insertDynamicMap"]',t.div),l,r;var s=c('<iframe class="ke-textarea" frameborder="0" src="'+u.pluginsPath+'baidumap/map.html" style="width:'+h+"px;height:"+m+'px;"></iframe>');function d(){l=s[0].contentWindow;r=c.iframeDoc(s)}s.bind("load",function(){s.unbind("load");if(c.IE){d()}else{setTimeout(d,0)}});c(".ke-map",n).replaceWith(s);a.click(function(){l.search(i.val())})})});KindEditor.plugin("map",function(c){var u=this,f="map",p=u.lang(f+".");u.clickToolbar(f,function(){var e=['<div style="padding:10px 20px;">','<div class="ke-dialog-row">',p.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+p.search+'" />',"</span>","</div>",'<div class="ke-map" style="width:558px;height:360px;"></div>',"</div>"].join("");var t=u.createDialog({name:f,width:600,title:u.lang(f),body:e,yesBtn:{name:u.lang("yes"),click:function(e){var t=l.geocoder,n=l.map,i=n.getCenter().lat()+","+n.getCenter().lng(),a=n.getZoom(),r=n.getMapTypeId(),o="http://maps.googleapis.com/maps/api/staticmap";o+="?center="+encodeURIComponent(i);o+="&zoom="+encodeURIComponent(a);o+="&size=558x360";o+="&maptype="+encodeURIComponent(r);o+="&markers="+encodeURIComponent(i);o+="&language="+u.langType;o+="&sensor=false";u.exec("insertimage",o).hideDialog().focus()}},beforeRemove:function(){a.remove();if(r){r.write("")}s.remove()}});var n=t.div,i=c('[name="address"]',n),a=c('[name="searchBtn"]',n),l,r;var o=["<!doctype html><html><head>",'<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />',"<style>","\thtml { height: 100% }","\tbody { height: 100%; margin: 0; padding: 0; background-color: #FFF }","\t#map_canvas { height: 100% }","</style>",'<script src="http://maps.googleapis.com/maps/api/js?sensor=false&language='+u.langType+'"><\/script>',"<script>","var map, geocoder;","function initialize() {","\tvar latlng = new google.maps.LatLng(31.230393, 121.473704);","\tvar options = {","\t\tzoom: 11,","\t\tcenter: latlng,","\t\tdisableDefaultUI: true,","\t\tpanControl: true,","\t\tzoomControl: true,","\t\tmapTypeControl: true,","\t\tscaleControl: true,","\t\tstreetViewControl: false,","\t\toverviewMapControl: true,","\t\tmapTypeId: google.maps.MapTypeId.ROADMAP","\t};",'\tmap = new google.maps.Map(document.getElementById("map_canvas"), options);',"\tgeocoder = new google.maps.Geocoder();","\tgeocoder.geocode({latLng: latlng}, function(results, status) {","\t\tif (status == google.maps.GeocoderStatus.OK) {","\t\t\tif (results[3]) {",'\t\t\t\tparent.document.getElementById("kindeditor_plugin_map_address").value = results[3].formatted_address;',"\t\t\t}","\t\t}","\t});","}","function search(address) {","\tif (!map) return;","\tgeocoder.geocode({address : address}, function(results, status) {","\t\tif (status == google.maps.GeocoderStatus.OK) {","\t\t\tmap.setZoom(11);","\t\t\tmap.setCenter(results[0].geometry.location);","\t\t\tvar marker = new google.maps.Marker({","\t\t\t\tmap: map,","\t\t\t\tposition: results[0].geometry.location","\t\t\t});","\t\t} else {",'\t\t\talert("Invalid address: " + address);',"\t\t}","\t});","}","<\/script>","</head>",'<body onload="initialize();">','<div id="map_canvas" style="width:100%; height:100%"></div>',"</body></html>"].join("\n");var s=c('<iframe class="ke-textarea" frameborder="0" src="'+u.pluginsPath+'map/map.html" style="width:558px;height:360px;"></iframe>');function d(){l=s[0].contentWindow;r=c.iframeDoc(s)}s.bind("load",function(){s.unbind("load");if(c.IE){d()}else{setTimeout(d,0)}});c(".ke-map",n).replaceWith(s);a.click(function(){l.search(i.val())})})});KindEditor.plugin("clearhtml",function(t){var n=this,e="clearhtml";n.clickToolbar(e,function(){n.focus();var e=n.html();e=e.replace(/(<script[^>]*>)([\s\S]*?)(<\/script>)/gi,"");e=e.replace(/(<style[^>]*>)([\s\S]*?)(<\/style>)/gi,"");e=t.formatHtml(e,{a:["href","target"],embed:["src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess"],img:["src","width","height","border","alt","title",".width",".height"],table:["border"],"td,th":["rowspan","colspan"],"div,hr,br,tbody,tr,p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":[]});n.html(e);n.cmd.selection(true);n.addBookmark()})});KindEditor.plugin("code",function(s){var d=this,t="code";d.clickToolbar(t,function(){var r=d.lang(t+"."),e=['<div style="padding:10px 20px;">','<div class="ke-dialog-row">','<select class="ke-code-type">','<option value="js">JavaScript</option>','<option value="html">HTML</option>','<option value="css">CSS</option>','<option value="php">PHP</option>','<option value="pl">Perl</option>','<option value="py">Python</option>','<option value="rb">Ruby</option>','<option value="java">Java</option>','<option value="vb">ASP/VB</option>','<option value="cpp">C/C++</option>','<option value="cs">C#</option>','<option value="xml">XML</option>','<option value="bsh">Shell</option>','<option value="">Other</option>',"</select>","</div>",'<textarea class="ke-textarea" style="width:408px;height:260px;"></textarea>',"</div>"].join(""),o=d.createDialog({name:t,width:450,title:d.lang(t),body:e,yesBtn:{name:d.lang("yes"),click:function(e){var t=s(".ke-code-type",o.div).val(),n=l.val(),i=t===""?"":" lang-"+t,a='<pre class="prettyprint'+i+'">\n'+s.escape(n)+"</pre> ";if(s.trim(n)===""){alert(r.pleaseInput);l[0].focus();return}d.insertHtml(a).hideDialog().focus()}}}),l=s("textarea",o.div);l[0].focus()})});KindEditor.plugin("emoticons",function(b){var k=this,y="emoticons",w=k.emoticonsPath||k.pluginsPath+"emoticons/images/",C=k.allowPreviewEmoticons===undefined?true:k.allowPreviewEmoticons,x=1;k.clickToolbar(y,function(){var d=5,c=9,e=135,u=0,f=d*c,i=Math.ceil(e/f),a=Math.floor(c/2),r=b('<div class="ke-plugin-emoticons"></div>'),p=[],t=k.createMenu({name:y,beforeRemove:function(){s()}});t.div.append(r);var h,o;if(C){h=b('<div class="ke-preview"></div>').css("right",0);o=b('<img class="ke-preview-img" src="'+w+u+'.gif" />');r.append(h);h.append(o)}function m(e,t,n){if(h){e.mouseover(function(){if(t>a){h.css("left",0);h.css("right","")}else{h.css("left","");h.css("right",0)}o.attr("src",w+n+".gif");b(this).addClass("ke-on")})}else{e.mouseover(function(){b(this).addClass("ke-on")})}e.mouseout(function(){b(this).removeClass("ke-on")});e.click(function(e){k.insertHtml('<img src="'+w+n+'.gif" border="0" alt="" />').hideMenu().focus();e.stop()})}function n(e,t){var n=document.createElement("table");t.append(n);if(h){b(n).mouseover(function(){h.show("block")});b(n).mouseout(function(){h.hide()});p.push(b(n))}n.className="ke-table";n.cellPadding=0;n.cellSpacing=0;n.border=0;var i=(e-1)*f+u;for(var a=0;a<d;a++){var r=n.insertRow(a);for(var o=0;o<c;o++){var l=b(r.insertCell(o));l.addClass("ke-cell");m(l,o,i);var s=b('<span class="ke-img"></span>').css("background-position","-"+24*i+"px 0px").css("background-image","url("+w+"static.gif)");l.append(s);p.push(l);i++}}return n}var l=n(x,r);function s(){b.each(p,function(){this.unbind()})}var g;function v(e,t){e.click(function(e){s();l.parentNode.removeChild(l);g.remove();l=n(t,r);_(t);x=t;e.stop()})}function _(e){g=b('<div class="ke-page"></div>');r.append(g);for(var t=1;t<=i;t++){if(e!==t){var n=b('<a href="javascript:;">['+t+"]</a>");v(n,t);g.append(n);p.push(n)}else{g.append(b("@["+t+"]"))}g.append(b("@&nbsp;"))}}_(x)})});KindEditor.plugin("filemanager",function(y){var w=this,C="filemanager",x=y.undef(w.fileManagerJson,w.basePath+"php/file_manager_json.php"),T=w.pluginsPath+C+"/images/",E=w.lang(C+".");function n(e,t,n){return e+" ("+Math.ceil(t/1024)+"KB, "+n+")"}function K(e,t){if(t.is_dir){e.attr("title",t.filename)}else{e.attr("title",n(t.filename,t.filesize,t.datetime))}}w.plugin.filemanagerDialog=function(e){var t=y.undef(e.width,650),n=y.undef(e.height,510),a=y.undef(e.dirName,""),i=y.undef(e.viewType,"VIEW").toUpperCase(),o=e.clickFn;var r=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+T+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+E.moveup+"</a>","</div>",'<div class="ke-right">',E.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+E.viewImage+"</option>",'<option value="LIST">'+E.listImage+"</option>","</select> ",E.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+E.fileName+"</option>",'<option value="SIZE">'+E.fileSize+"</option>",'<option value="TYPE">'+E.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join("");var l=w.createDialog({name:C,width:t,height:n,title:w.lang(C),body:r}),s=l.div,c=y(".ke-plugin-filemanager-body",s),d=y('[name="moveupImg"]',s),u=y('[name="moveupLink"]',s),f=y('[name="viewServer"]',s),p=y('[name="viewType"]',s),h=y('[name="orderType"]',s);function m(e,t,n){var i="path="+e+"&order="+t+"&dir="+a;l.showLoading(w.lang("ajaxLoading"));y.ajax(y.addParam(x,i+"&"+(new Date).getTime()),function(e){l.hideLoading();n(e)})}var g=[];function v(e,t,n,i){var a=y.formatUrl(t.current_url+n.filename,"absolute"),r=encodeURIComponent(t.current_dir_path+n.filename+"/");if(n.is_dir){e.click(function(e){m(r,h.val(),i)})}else if(n.is_photo){e.click(function(e){o.call(this,a,n.filename)})}else{e.click(function(e){o.call(this,a,n.filename)})}g.push(e)}function _(t,n){y.each(g,function(){this.unbind()});u.unbind();p.unbind();h.unbind();if(t.current_dir_path){u.click(function(e){m(t.moveup_dir_path,h.val(),n)})}function e(){if(p.val()=="VIEW"){m(t.current_dir_path,h.val(),k)}else{m(t.current_dir_path,h.val(),b)}}p.change(e);h.change(e);c.html("")}function b(e){_(e,b);var t=document.createElement("table");t.className="ke-table";t.cellPadding=0;t.cellSpacing=0;t.border=0;c.append(t);var n=e.file_list;for(var i=0,a=n.length;i<a;i++){var r=n[i],o=y(t.insertRow(i));o.mouseover(function(e){y(this).addClass("ke-on")}).mouseout(function(e){y(this).removeClass("ke-on")});var l=T+(r.is_dir?"folder-16.gif":"file-16.gif"),s=y('<img src="'+l+'" width="16" height="16" alt="'+r.filename+'" align="absmiddle" />'),d=y(o[0].insertCell(0)).addClass("ke-cell ke-name").append(s).append(document.createTextNode(" "+r.filename));if(!r.is_dir||r.has_file){o.css("cursor","pointer");d.attr("title",r.filename);v(d,e,r,b)}else{d.attr("title",E.emptyFolder)}y(o[0].insertCell(1)).addClass("ke-cell ke-size").html(r.is_dir?"-":Math.ceil(r.filesize/1024)+"KB");y(o[0].insertCell(2)).addClass("ke-cell ke-datetime").html(r.datetime)}}function k(e){_(e,k);var t=e.file_list;for(var n=0,i=t.length;n<i;n++){var a=t[n],r=y('<div class="ke-inline-block ke-item"></div>');c.append(r);var o=y('<div class="ke-inline-block ke-photo"></div>').mouseover(function(e){y(this).addClass("ke-on")}).mouseout(function(e){y(this).removeClass("ke-on")});r.append(o);var l=e.current_url+a.filename,s=a.is_dir?T+"folder-64.gif":a.is_photo?l:T+"file-64.gif";var d=y('<img src="'+s+'" width="80" height="80" alt="'+a.filename+'" />');if(!a.is_dir||a.has_file){o.css("cursor","pointer");K(o,a);v(o,e,a,k)}else{o.attr("title",E.emptyFolder)}o.append(d);r.append('<div class="ke-name" title="'+a.filename+'">'+a.filename+"</div>")}}p.val(i);m("",h.val(),i=="VIEW"?k:b);return l}});KindEditor.plugin("image",function(e){var n=this;setTimeout(function(e,t){layui.upload.render({elem:$("#"+TTTXUANCLASS+"idx_"+e).find('[data-name="image"]'),field:"all",url:uploadurl(""),auto:!BASEUP,choose:function(i){if(BASEUP){i.preview(function(e,t,n){t=new File([n],t.name);i.upload(e,t)})}},done:function(e){if(e.code==1){if(typeof pichttp=="function"){n.exec("insertimage",pichttp(e.data)).focus()}else{n.exec("insertimage",e.data).focus()}}else{layer.msg(e.msg,{offset:"c"})}}})},800,n.options.ttttt)});KindEditor.plugin("insertfile",function(u){var f=this,p="insertfile",h=u.undef(f.allowFileUpload,true),m=u.undef(f.allowFileManager,false),g=u.undef(f.formatUploadUrl,true),v=uploadurl("");extraParams=u.undef(f.extraFileUploadParams,{}),filePostName=u.undef(f.filePostName,"file"),lang=f.lang(p+".");f.plugin.fileDialog=function(e){var t=u.undef(e.fileUrl,"http://"),n=u.undef(e.fileTitle,""),i=e.clickFn;var a=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+lang.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+lang.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+lang.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+lang.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join("");var r=f.createDialog({name:p,width:450,title:f.lang(p),body:a,yesBtn:{name:f.lang("yes"),click:function(e){var t=u.trim(l.val()),n=d.val();if(t=="http://"||u.invalidUrl(t)){alert(f.lang("invalidUrl"));l[0].focus();return}if(u.trim(n)===""){n=t}i.call(f,t,n)}}}),o=r.div;var l=u('[name="url"]',o),s=u('[name="viewServer"]',o),d=u('[name="title"]',o);if(h){var c=u.uploadbutton({button:u(".ke-upload-button",o)[0],fieldName:filePostName,url:u.addParam(v,"uplx=file"),extraParams:extraParams,afterUpload:function(e){r.hideLoading();if(e.code===1){var t=e.data;if(typeof pichttp=="function"){t=pichttp(t)}if(g){t=u.formatUrl(t,"absolute")}l.val(t);if(f.afterUpload){f.afterUpload.call(f,t,e,p)}alert(f.lang("uploadSuccess"))}else{alert(e.msg)}},afterError:function(e){r.hideLoading();f.errorDialog(e)}});c.fileBox.change(function(e){r.showLoading(f.lang("uploadLoading"));c.submit()})}else{u(".ke-upload-button",o).hide()}if(m){s.click(function(e){f.loadPlugin("filemanager",function(){f.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(e,t){if(f.dialogs.length>1){u('[name="url"]',o).val(e);if(f.afterSelectFile){f.afterSelectFile.call(f,e)}f.hideDialog()}}})})})}else{s.hide()}l.val(t);d.val(n);l[0].focus();l[0].select()};f.clickToolbar(p,function(){f.plugin.fileDialog({clickFn:function(e,t){var n='<a class="ke-insertfile" href="'+e+'" data-ke-src="'+e+'" target="_blank">'+t+"</a>";f.insertHtml(n).hideDialog().focus()}})})});KindEditor.plugin("lineheight",function(a){var r=this,t="lineheight",o=r.lang(t+".");r.clickToolbar(t,function(){var n="",e=r.cmd.commonNode({"*":".line-height"});if(e){n=e.css("line-height")}var i=r.createMenu({name:t,width:150});a.each(o.lineHeight,function(e,t){a.each(t,function(e,t){i.addItem({title:t,checked:n===e,click:function(){r.cmd.toggle('<span style="line-height:'+e+';"></span>',{span:".line-height="+e});r.updateState();r.addBookmark();r.hideMenu()}})})})})});KindEditor.plugin("link",function(l){var s=this,d="link";s.plugin.link={edit:function(){var e=s.lang(d+"."),t='<div style="padding:20px;"><div class="ke-dialog-row"><label for="keUrl" style="width:60px;">'+e.url+'</label><input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:260px;" /></div><div class="ke-dialog-row""><label for="keType" style="width:60px;">'+e.linkType+'</label><select id="keType" name="type"></select></div></div>',n=s.createDialog({name:d,width:450,title:s.lang(d),body:t,yesBtn:{name:s.lang("yes"),click:function(e){var t=l.trim(a.val());if(t=="http://"||l.invalidUrl(t)){alert(s.lang("invalidUrl"));a[0].focus();return}s.exec("createlink",t,r.val()).hideDialog().focus()}}}),i=n.div,a=l('input[name="url"]',i),r=l('select[name="type"]',i);a.val("http://");r[0].options[0]=new Option(e.newWindow,"_blank");r[0].options[1]=new Option(e.selfWindow,"");s.cmd.selection();var o=s.plugin.getSelectedLink();if(o){s.cmd.range.selectNode(o[0]);s.cmd.select();a.val(o.attr("data-ke-src"));r.val(o.attr("target"))}a[0].focus();a[0].select()},delete:function(){s.exec("unlink",null)}};s.clickToolbar(d,s.plugin.link.edit)});KindEditor.plugin("media",function(u){var f=this,p="media",h=f.lang(p+"."),m=u.undef(f.allowMediaUpload,true),g=u.undef(f.allowFileManager,false),v=u.undef(f.formatUploadUrl,true),_=u.undef(f.extraFileUploadParams,{}),b=u.undef(f.filePostName,"media"),k=uploadurl("");f.plugin.media={edit:function(){var e=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+h.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+h.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+h.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+h.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+h.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+h.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join("");var n=f.createDialog({name:p,width:450,height:230,title:f.lang(p),body:e,yesBtn:{name:f.lang("yes"),click:function(e){var t=u.trim(r.val()),n=o.val(),i=l.val();if(t=="http://"||u.invalidUrl(t)){alert(f.lang("invalidUrl"));r[0].focus();return}if(!/^\d*$/.test(n)){alert(f.lang("invalidWidth"));o[0].focus();return}if(!/^\d*$/.test(i)){alert(f.lang("invalidHeight"));l[0].focus();return}var a=u.mediaImg(f.themesPath+"common/blank.gif",{src:t,type:u.mediaType(t),width:n,height:i,autostart:s[0].checked?"true":"false",loop:"true"});f.insertHtml(a).hideDialog().focus()}}}),i=n.div,r=u('[name="url"]',i),t=u('[name="viewServer"]',i),o=u('[name="width"]',i),l=u('[name="height"]',i),s=u('[name="autostart"]',i);r.val("http://");if(m){var a=u.uploadbutton({button:u(".ke-upload-button",i)[0],fieldName:b,extraParams:_,url:u.addParam(k,"uplx=media"),afterUpload:function(e){n.hideLoading();if(e.code===1){var t=e.data;if(typeof pichttp=="function"){t=pichttp(t)}if(v){t=u.formatUrl(t,"absolute")}r.val(t);if(f.afterUpload){f.afterUpload.call(f,t,e,p)}alert(f.lang("uploadSuccess"))}else{alert(e.msg)}},afterError:function(e){n.hideLoading();f.errorDialog(e)}});a.fileBox.change(function(e){n.showLoading(f.lang("uploadLoading"));a.submit()})}else{u(".ke-upload-button",i).hide()}if(g){t.click(function(e){f.loadPlugin("filemanager",function(){f.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(e,t){if(f.dialogs.length>1){u('[name="url"]',i).val(e);if(f.afterSelectFile){f.afterSelectFile.call(f,e)}f.hideDialog()}}})})})}else{t.hide()}var d=f.plugin.getSelectedMedia();if(d){var c=u.mediaAttrs(d.attr("data-ke-tag"));r.val(c.src);o.val(u.removeUnit(d.css("width"))||c.width||0);l.val(u.removeUnit(d.css("height"))||c.height||0);s[0].checked=c.autostart==="true"}r[0].focus();r[0].select()},delete:function(){f.plugin.getSelectedMedia().remove();f.addBookmark()}};f.clickToolbar(p,f.plugin.media.edit)});KindEditor.plugin("pagebreak",function(a){var r=this;var e="pagebreak";var o=a.undef(r.pagebreakHtml,'<hr style="page-break-after: always;" class="ke-pagebreak" />');r.clickToolbar(e,function(){var e=r.cmd,t=e.range;r.focus();var n=r.newlineTag=="br"||a.WEBKIT?"":'<span id="__kindeditor_tail_tag__"></span>';r.insertHtml(o+n);if(n!==""){var i=a("#__kindeditor_tail_tag__",r.edit.doc);t.selectNodeContents(i[0]);i.removeAttr("id");e.select()}})});KindEditor.plugin("plainpaste",function(a){var r=this,o="plainpaste";r.clickToolbar(o,function(){var e=r.lang(o+"."),t='<div style="padding:10px 20px;"><div style="margin-bottom:10px;">'+e.comment+'</div><textarea class="ke-textarea" style="width:408px;height:260px;"></textarea></div>',n=r.createDialog({name:o,width:450,title:r.lang(o),body:t,yesBtn:{name:r.lang("yes"),click:function(e){var t=i.val();t=a.escape(t);t=t.replace(/ {2}/g," &nbsp;");if(r.newlineTag=="p"){t=t.replace(/^/,"<p>").replace(/$/,"</p>").replace(/\n/g,"</p><p>")}else{t=t.replace(/\n/g,"<br />$&")}r.insertHtml(t).hideDialog().focus()}}}),i=a("textarea",n.div);i[0].focus()})});KindEditor.plugin("preview",function(r){var o=this,l="preview",e;o.clickToolbar(l,function(){var e=o.lang(l+"."),t='<div style="padding:10px 20px;"><iframe class="ke-textarea" frameborder="0" style="width:708px;height:400px;"></iframe></div>',n=o.createDialog({name:l,width:750,title:o.lang(l),body:t}),i=r("iframe",n.div),a=r.iframeDoc(i);a.open();a.write(o.fullHtml());a.close();r(a.body).css("background-color","#FFF");i[0].contentWindow.focus()})});KindEditor.plugin("quickformat",function(s){var d=this,e="quickformat",c=s.toMap("blockquote,center,div,h1,h2,h3,h4,h5,h6,p");function u(e){var t=e.first();while(t&&t.first()){t=t.first()}return t}d.clickToolbar(e,function(){d.focus();var i=d.edit.doc,e=d.cmd.range,t=s(i.body).first(),n,a=[],r=[],o=e.createBookmark(true);while(t){n=t.next();var l=u(t);if(!l||l.name!="img"){if(c[t.name]){t.html(t.html().replace(/^(\s|&nbsp;|　)+/gi,""));t.css("text-indent","2em")}else{r.push(t)}if(!n||(c[n.name]||c[t.name]&&!c[n.name])){if(r.length>0){a.push(r)}r=[]}}t=n}s.each(a,function(e,t){var n=s('<p style="text-indent:2em;"></p>',i);t[0].before(n);s.each(t,function(e,t){n.append(t)})});e.moveToBookmark(o);d.addBookmark()})});KindEditor.plugin("table",function(N){var M=this,l="table",s=M.lang(l+"."),I="ke-zeroborder";function d(e,t){t=t.toUpperCase();e.css("background-color",t);e.css("color",t==="#000000"?"#FFFFFF":"#000000");e.html(t)}var o=[];function c(a,e){e.bind("click,mousedown",function(e){e.stopPropagation()});function r(){N.each(o,function(){this.remove()});o=[];N(document).unbind("click,mousedown",r);a.unbind("click,mousedown",r)}e.click(function(e){r();var t=N(this),n=t.pos();var i=N.colorpicker({x:n.x,y:n.y+t.height(),z:811214,selectedColor:N(this).html(),colors:M.colorTable,noColor:M.lang("noColor"),shadowMode:M.shadowMode,click:function(e){d(t,e);r()}});o.push(i);N(document).bind("click,mousedown",r);a.bind("click,mousedown",r)})}function u(e,t,n){var i=0;for(var a=0,r=t.cells.length;a<r;a++){if(t.cells[a]==n){break}i+=t.cells[a].rowSpan-1}return n.cellIndex-i}M.plugin.table={prop:function(e){var t=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keRows" style="width:90px;">'+s.cells+"</label>",s.rows+' <input type="text" id="keRows" class="ke-input-text ke-input-number" name="rows" value="" maxlength="4" /> &nbsp; ',s.cols+' <input type="text" class="ke-input-text ke-input-number" name="cols" value="" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:90px;">'+s.size+"</label>",s.width+' <input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> &nbsp; ','<select name="widthType">','<option value="%">'+s.percent+"</option>",'<option value="px">'+s.px+"</option>","</select> &nbsp; ",s.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> &nbsp; ','<select name="heightType">','<option value="%">'+s.percent+"</option>",'<option value="px">'+s.px+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="kePadding" style="width:90px;">'+s.space+"</label>",s.padding+' <input type="text" id="kePadding" class="ke-input-text ke-input-number" name="padding" value="" maxlength="4" /> &nbsp; ',s.spacing+' <input type="text" class="ke-input-text ke-input-number" name="spacing" value="" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAlign" style="width:90px;">'+s.align+"</label>",'<select id="keAlign" name="align">','<option value="">'+s.alignDefault+"</option>",'<option value="left">'+s.alignLeft+"</option>",'<option value="center">'+s.alignCenter+"</option>",'<option value="right">'+s.alignRight+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keBorder" style="width:90px;">'+s.border+"</label>",s.borderWidth+' <input type="text" id="keBorder" class="ke-input-text ke-input-number" name="border" value="" maxlength="4" /> &nbsp; ',s.borderColor+' <span class="ke-inline-block ke-input-color"></span>',"</div>",'<div class="ke-dialog-row">','<label for="keBgColor" style="width:90px;">'+s.backgroundColor+"</label>",'<span class="ke-inline-block ke-input-color"></span>',"</div>","</div>"].join("");var v=M.cmd.range.createBookmark();var n=M.createDialog({name:l,width:500,title:M.lang(l),body:t,beforeRemove:function(){S.unbind()},yesBtn:{name:M.lang("yes"),click:function(e){var t=_.val(),n=b.val(),i=k.val(),a=y.val(),r=w.val(),o=C.val(),l=x.val(),s=T.val(),d=E.val(),c=K.val(),u=N(S[0]).html()||"",f=N(S[1]).html()||"";if(t==0||!/^\d+$/.test(t)){alert(M.lang("invalidRows"));_[0].focus();return}if(n==0||!/^\d+$/.test(n)){alert(M.lang("invalidRows"));b[0].focus();return}if(!/^\d*$/.test(i)){alert(M.lang("invalidWidth"));k[0].focus();return}if(!/^\d*$/.test(a)){alert(M.lang("invalidHeight"));y[0].focus();return}if(!/^\d*$/.test(l)){alert(M.lang("invalidPadding"));x[0].focus();return}if(!/^\d*$/.test(s)){alert(M.lang("invalidSpacing"));T[0].focus();return}if(!/^\d*$/.test(c)){alert(M.lang("invalidBorder"));K[0].focus();return}if(A){if(i!==""){A.width(i+r)}else{A.css("width","")}if(A[0].width!==undefined){A.removeAttr("width")}if(a!==""){A.height(a+o)}else{A.css("height","")}if(A[0].height!==undefined){A.removeAttr("height")}A.css("background-color",f);if(A[0].bgColor!==undefined){A.removeAttr("bgColor")}if(l!==""){A[0].cellPadding=l}else{A.removeAttr("cellPadding")}if(s!==""){A[0].cellSpacing=s}else{A.removeAttr("cellSpacing")}if(d!==""){A[0].align=d}else{A.removeAttr("align")}if(c!==""){A.attr("border",c)}else{A.removeAttr("border")}if(c===""||c==="0"){A.addClass(I)}else{A.removeClass(I)}if(u!==""){A.attr("borderColor",u)}else{A.removeAttr("borderColor")}M.hideDialog().focus();M.cmd.range.moveToBookmark(v);M.cmd.select();M.addBookmark();return}var p="";if(i!==""){p+="width:"+i+r+";"}if(a!==""){p+="height:"+a+o+";"}if(f!==""){p+="background-color:"+f+";"}var h="<table";if(p!==""){h+=' style="'+p+'"'}if(l!==""){h+=' cellpadding="'+l+'"'}if(s!==""){h+=' cellspacing="'+s+'"'}if(d!==""){h+=' align="'+d+'"'}if(c!==""){h+=' border="'+c+'"'}if(c===""||c==="0"){h+=' class="'+I+'"'}if(u!==""){h+=' bordercolor="'+u+'"'}h+=">";for(var m=0;m<t;m++){h+="<tr>";for(var g=0;g<n;g++){h+="<td>"+(N.IE?"&nbsp;":"<br />")+"</td>"}h+="</tr>"}h+="</table>";if(!N.IE){h+="<br />"}M.insertHtml(h);M.select().hideDialog().focus();M.addBookmark()}}}),i=n.div,_=N('[name="rows"]',i).val(3),b=N('[name="cols"]',i).val(2),k=N('[name="width"]',i).val(100),y=N('[name="height"]',i),w=N('[name="widthType"]',i),C=N('[name="heightType"]',i),x=N('[name="padding"]',i).val(2),T=N('[name="spacing"]',i).val(0),E=N('[name="align"]',i),K=N('[name="border"]',i).val(1),S=N(".ke-input-color",i);c(i,S.eq(0));c(i,S.eq(1));d(S.eq(0),"#000000");d(S.eq(1),"");_[0].focus();_[0].select();var A;if(e){return}A=M.plugin.getSelectedTable();if(A){_.val(A[0].rows.length);b.val(A[0].rows.length>0?A[0].rows[0].cells.length:0);_.attr("disabled",true);b.attr("disabled",true);var a,r=A[0].style.width||A[0].width,o=A[0].style.height||A[0].height;if(r!==undefined&&(a=/^(\d+)((?:px|%)*)$/.exec(r))){k.val(a[1]);w.val(a[2])}else{k.val("")}if(o!==undefined&&(a=/^(\d+)((?:px|%)*)$/.exec(o))){y.val(a[1]);C.val(a[2])}x.val(A[0].cellPadding||"");T.val(A[0].cellSpacing||"");E.val(A[0].align||"");K.val(A[0].border===undefined?"":A[0].border);d(S.eq(0),N.toHex(A.attr("borderColor")||""));d(S.eq(1),N.toHex(A[0].style.backgroundColor||A[0].bgColor||""));k[0].focus();k[0].select()}},cellprop:function(){var e=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keWidth" style="width:90px;">'+s.size+"</label>",s.width+' <input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> &nbsp; ','<select name="widthType">','<option value="%">'+s.percent+"</option>",'<option value="px">'+s.px+"</option>","</select> &nbsp; ",s.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> &nbsp; ','<select name="heightType">','<option value="%">'+s.percent+"</option>",'<option value="px">'+s.px+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keAlign" style="width:90px;">'+s.align+"</label>",s.textAlign+' <select id="keAlign" name="textAlign">','<option value="">'+s.alignDefault+"</option>",'<option value="left">'+s.alignLeft+"</option>",'<option value="center">'+s.alignCenter+"</option>",'<option value="right">'+s.alignRight+"</option>","</select> ",s.verticalAlign+' <select name="verticalAlign">','<option value="">'+s.alignDefault+"</option>",'<option value="top">'+s.alignTop+"</option>",'<option value="middle">'+s.alignMiddle+"</option>",'<option value="bottom">'+s.alignBottom+"</option>",'<option value="baseline">'+s.alignBaseline+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keBorder" style="width:90px;">'+s.border+"</label>",s.borderWidth+' <input type="text" id="keBorder" class="ke-input-text ke-input-number" name="border" value="" maxlength="4" /> &nbsp; ',s.borderColor+' <span class="ke-inline-block ke-input-color"></span>',"</div>",'<div class="ke-dialog-row">','<label for="keBgColor" style="width:90px;">'+s.backgroundColor+"</label>",'<span class="ke-inline-block ke-input-color"></span>',"</div>","</div>"].join("");var f=M.cmd.range.createBookmark();var t=M.createDialog({name:l,width:500,title:M.lang("tablecell"),body:e,beforeRemove:function(){w.unbind()},yesBtn:{name:M.lang("yes"),click:function(e){var t=p.val(),n=h.val(),i=m.val(),a=g.val(),r=v.val(),o=_.val(),l=b.val(),s=k.val(),d=y.val(),c=N(w[0]).html()||"",u=N(w[1]).html()||"";if(!/^\d*$/.test(t)){alert(M.lang("invalidWidth"));p[0].focus();return}if(!/^\d*$/.test(n)){alert(M.lang("invalidHeight"));h[0].focus();return}if(!/^\d*$/.test(d)){alert(M.lang("invalidBorder"));y[0].focus();return}C.css({width:t!==""?t+i:"",height:n!==""?n+a:"","background-color":u,"text-align":l,"vertical-align":s,"border-width":d,"border-style":d!==""?"solid":"","border-color":c});M.hideDialog().focus();M.cmd.range.moveToBookmark(f);M.cmd.select();M.addBookmark()}}}),n=t.div,p=N('[name="width"]',n).val(100),h=N('[name="height"]',n),m=N('[name="widthType"]',n),g=N('[name="heightType"]',n),v=N('[name="padding"]',n).val(2),_=N('[name="spacing"]',n).val(0),b=N('[name="textAlign"]',n),k=N('[name="verticalAlign"]',n),y=N('[name="border"]',n).val(1),w=N(".ke-input-color",n);c(n,w.eq(0));c(n,w.eq(1));d(w.eq(0),"#000000");d(w.eq(1),"");p[0].focus();p[0].select();var C=M.plugin.getSelectedCell();var i,a=C[0].style.width||C[0].width||"",r=C[0].style.height||C[0].height||"";if(i=/^(\d+)((?:px|%)*)$/.exec(a)){p.val(i[1]);m.val(i[2])}else{p.val("")}if(i=/^(\d+)((?:px|%)*)$/.exec(r)){h.val(i[1]);g.val(i[2])}b.val(C[0].style.textAlign||"");k.val(C[0].style.verticalAlign||"");var o=C[0].style.borderWidth||"";if(o){o=parseInt(o)}y.val(o);d(w.eq(0),N.toHex(C[0].style.borderColor||""));d(w.eq(1),N.toHex(C[0].style.backgroundColor||""));p[0].focus();p[0].select()},insert:function(){this.prop(true)},delete:function(){var e=M.plugin.getSelectedTable();M.cmd.range.setStartBefore(e[0]).collapse(true);M.cmd.select();e.remove();M.addBookmark()},colinsert:function(e){var t=M.plugin.getSelectedTable()[0],n=M.plugin.getSelectedRow()[0],i=M.plugin.getSelectedCell()[0],a=i.cellIndex+e;a+=t.rows[0].cells.length-n.cells.length;for(var r=0,o=t.rows.length;r<o;r++){var l=t.rows[r],s=l.insertCell(a);s.innerHTML=N.IE?"":"<br />";a=u(t,l,s)}M.cmd.range.selectNodeContents(i).collapse(true);M.cmd.select();M.addBookmark()},colinsertleft:function(){this.colinsert(0)},colinsertright:function(){this.colinsert(1)},rowinsert:function(e){var t=M.plugin.getSelectedTable()[0],n=M.plugin.getSelectedRow()[0],i=M.plugin.getSelectedCell()[0];var a=n.rowIndex;if(e===1){a=n.rowIndex+(i.rowSpan-1)+e}var r=t.insertRow(a);for(var o=0,l=n.cells.length;o<l;o++){if(n.cells[o].rowSpan>1){l-=n.cells[o].rowSpan-1}var s=r.insertCell(o);if(e===1&&n.cells[o].colSpan>1){s.colSpan=n.cells[o].colSpan}s.innerHTML=N.IE?"":"<br />"}for(var d=a;d>=0;d--){var c=t.rows[d].cells;if(c.length>o){for(var u=i.cellIndex;u>=0;u--){if(c[u].rowSpan>1){c[u].rowSpan+=1}}break}}M.cmd.range.selectNodeContents(i).collapse(true);M.cmd.select();M.addBookmark()},rowinsertabove:function(){this.rowinsert(0)},rowinsertbelow:function(){this.rowinsert(1)},rowmerge:function(){var e=M.plugin.getSelectedTable()[0],t=M.plugin.getSelectedRow()[0],n=M.plugin.getSelectedCell()[0],i=t.rowIndex,a=i+n.rowSpan,r=e.rows[a];if(e.rows.length<=a){return}var o=n.cellIndex;if(r.cells.length<=o){return}var l=r.cells[o];if(n.colSpan!==l.colSpan){return}n.rowSpan+=l.rowSpan;r.deleteCell(o);M.cmd.range.selectNodeContents(n).collapse(true);M.cmd.select();M.addBookmark()},colmerge:function(){var e=M.plugin.getSelectedTable()[0],t=M.plugin.getSelectedRow()[0],n=M.plugin.getSelectedCell()[0],i=t.rowIndex,a=n.cellIndex,r=a+1;if(t.cells.length<=r){return}var o=t.cells[r];if(n.rowSpan!==o.rowSpan){return}n.colSpan+=o.colSpan;t.deleteCell(r);M.cmd.range.selectNodeContents(n).collapse(true);M.cmd.select();M.addBookmark()},rowsplit:function(){var e=M.plugin.getSelectedTable()[0],t=M.plugin.getSelectedRow()[0],n=M.plugin.getSelectedCell()[0],i=t.rowIndex;if(n.rowSpan===1){return}var a=u(e,t,n);for(var r=1,o=n.rowSpan;r<o;r++){var l=e.rows[i+r],s=l.insertCell(a);if(n.colSpan>1){s.colSpan=n.colSpan}s.innerHTML=N.IE?"":"<br />";a=u(e,l,s)}N(n).removeAttr("rowSpan");M.cmd.range.selectNodeContents(n).collapse(true);M.cmd.select();M.addBookmark()},colsplit:function(){var e=M.plugin.getSelectedTable()[0],t=M.plugin.getSelectedRow()[0],n=M.plugin.getSelectedCell()[0],i=n.cellIndex;if(n.colSpan===1){return}for(var a=1,r=n.colSpan;a<r;a++){var o=t.insertCell(i+a);if(n.rowSpan>1){o.rowSpan=n.rowSpan}o.innerHTML=N.IE?"":"<br />"}N(n).removeAttr("colSpan");M.cmd.range.selectNodeContents(n).collapse(true);M.cmd.select();M.addBookmark()},coldelete:function(){var e=M.plugin.getSelectedTable()[0],t=M.plugin.getSelectedRow()[0],n=M.plugin.getSelectedCell()[0],i=n.cellIndex;for(var a=0,r=e.rows.length;a<r;a++){var o=e.rows[a],l=o.cells[i];if(l.colSpan>1){l.colSpan-=1;if(l.colSpan===1){N(l).removeAttr("colSpan")}}else{o.deleteCell(i)}if(l.rowSpan>1){a+=l.rowSpan-1}}if(t.cells.length===0){M.cmd.range.setStartBefore(e).collapse(true);M.cmd.select();N(e).remove()}else{M.cmd.selection(true)}M.addBookmark()},rowdelete:function(){var e=M.plugin.getSelectedTable()[0],t=M.plugin.getSelectedRow()[0],n=M.plugin.getSelectedCell()[0],i=t.rowIndex;for(var a=n.rowSpan-1;a>=0;a--){e.deleteRow(i+a)}if(e.rows.length===0){M.cmd.range.setStartBefore(e).collapse(true);M.cmd.select();N(e).remove()}else{M.cmd.selection(true)}M.addBookmark()}};M.clickToolbar(l,M.plugin.table.prop)});KindEditor.plugin("template",function(o){var l=this,s="template",e=l.lang(s+"."),t=l.pluginsPath+s+"/html/";function d(e){return t+e+"?ver="+encodeURIComponent(o.DEBUG?o.TIME:o.VERSION)}l.clickToolbar(s,function(){var e=l.lang(s+"."),n=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',e.selectTemplate+" <select>"];o.each(e.fileList,function(e,t){n.push('<option value="'+e+'">'+t+"</option>")});html=[n.join(""),"</select></div>",'<div class="ke-right">','<input type="checkbox" id="keReplaceFlag" name="replaceFlag" value="1" /> <label for="keReplaceFlag">'+e.replaceContent+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<iframe class="ke-textarea" frameborder="0" style="width:458px;height:260px;background-color:#FFF;"></iframe>',"</div>"].join("");var t=l.createDialog({name:s,width:500,title:l.lang(s),body:html,yesBtn:{name:l.lang("yes"),click:function(e){var t=o.iframeDoc(r);l[a[0].checked?"html":"insertHtml"](t.body.innerHTML).hideDialog().focus()}}});var i=o("select",t.div),a=o('[name="replaceFlag"]',t.div),r=o("iframe",t.div);a[0].checked=true;r.attr("src",d(i.val()));i.change(function(){r.attr("src",d(this.value))})})});KindEditor.plugin("wordpaste",function(o){var l=this,s="wordpaste";l.clickToolbar(s,function(){var e=l.lang(s+"."),t='<div style="padding:10px 20px;"><div style="margin-bottom:10px;">'+e.comment+'</div><iframe class="ke-textarea" frameborder="0" style="width:408px;height:260px;"></iframe></div>',n=l.createDialog({name:s,width:450,title:l.lang(s),body:t,yesBtn:{name:l.lang("yes"),click:function(e){var t=r.body.innerHTML;t=o.clearMsWord(t,l.filterMode?l.htmlTags:o.options.htmlTags);l.insertHtml(t).hideDialog().focus()}}}),i=n.div,a=o("iframe",i),r=o.iframeDoc(a);if(!o.IE){r.designMode="on"}r.open();r.write("<!doctype html><html><head><title>WordPaste</title></head>");r.write('<body style="background-color:#FFF;font-size:12px;margin:2px;">');if(!o.IE){r.write("<br />")}r.write("</body></html>");r.close();if(o.IE){r.body.contentEditable="true"}a[0].contentWindow.focus()})});KindEditor.plugin("fixtoolbar",function(n){var e=this;if(!e.fixToolBar){return}function t(){var e=n(".ke-toolbar");var t=e.pos().y;n(window).bind("scroll",function(){if(e.css("position")=="fixed"){if(document.body.scrollTop-t<0){e.css("position","static");e.css("top","auto")}}else{if(e.pos().y-document.body.scrollTop<0){e.css("position","fixed");e.css("top",0)}}})}if(e.isCreated){t()}else{e.afterCreate(t)}});